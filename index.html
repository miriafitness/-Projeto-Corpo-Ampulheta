<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>üçë Projeto Ampulheta - Miri√£</title>

  <meta name="theme-color" content="#ff2d7a" />
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="apple-touch-icon" href="icons/icon-192.png">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <style>
    :root{
      --bg1:#fff0f6;
      --bg2:#ffe6f0;
      --card:#ffffff;
      --pink:#ff2d7a;
      --pink2:#ff5aa5;
      --text:#1c1c1c;
      --muted:#6b6b6b;
      --shadow2: 0 10px 24px rgba(0,0,0,.08);
      --radius: 18px;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: Inter, Arial, sans-serif;
      color:var(--text);
      background: radial-gradient(1200px 700px at 50% -200px, #ffffff 0%, var(--bg1) 40%, var(--bg2) 100%);
      padding: 18px 14px 92px;
    }
    .wrap{ max-width: 980px; margin: 0 auto; }
    header{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px;
      margin: 10px 0 16px;
    }
    .brand{ display:flex; gap:10px; align-items:center; }
    .logo{
      width:44px; height:44px; border-radius:14px;
      display:grid; place-items:center;
      background: linear-gradient(135deg, var(--pink) 0%, var(--pink2) 100%);
      color:white; font-weight:800;
      box-shadow: 0 14px 40px rgba(255,45,122,.18);
    }
    h1{ margin:0; font-size: 18px; line-height:1.1; }
    .subtitle{ margin: 2px 0 0; color: var(--muted); font-size: 12px; }
    .pill{
      padding:10px 12px; border-radius: 999px;
      background: rgba(255,45,122,.12);
      color: var(--pink);
      font-weight: 700;
      font-size: 12px;
      border: 1px solid rgba(255,45,122,.18);
      white-space: nowrap;
    }
    .grid{ display:grid; grid-template-columns: 1fr; gap: 12px; }
    @media (min-width: 900px){
      .grid{ grid-template-columns: 1.05fr .95fr; align-items:start; }
    }
    .card{
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow2);
      border: 1px solid rgba(0,0,0,.04);
      overflow:hidden;
    }
    .cardHead{
      padding: 14px 14px 0;
      display:flex; align-items:flex-start; justify-content:space-between;
      gap:12px;
    }
    .cardTitle{ margin:0; font-size: 15px; font-weight: 800; letter-spacing: .2px; }
    .cardNote{ margin: 6px 0 0; font-size: 12px; color: var(--muted); }
    .cardBody{ padding: 14px; padding-top: 10px; }
    .row{ display:grid; grid-template-columns: 1fr; gap: 10px; margin: 10px 0; }
    @media (min-width: 560px){
      .row2{ grid-template-columns: 1fr 1fr; }
      .row3{ grid-template-columns: 1fr 1fr 1fr; }
    }
    label{ font-size: 12px; color: var(--muted); display:block; margin-bottom: 6px; }
    input, select, textarea{
      width: 100%;
      padding: 10px 10px;
      border-radius: 12px;
      border: 1px solid rgba(0,0,0,.10);
      outline: none;
      font-family: inherit;
      background: #fff;
    }
    .btnRow{ display:flex; flex-wrap:wrap; gap: 8px; margin-top: 10px; }
    button{
      background: linear-gradient(135deg, var(--pink) 0%, var(--pink2) 100%);
      color:white;
      border:none;
      padding: 10px 12px;
      border-radius: 12px;
      cursor:pointer;
      font-weight: 800;
      font-size: 13px;
      box-shadow: 0 10px 22px rgba(255,45,122,.22);
    }
    button.secondary{
      background: rgba(0,0,0,.04);
      color: #1f1f1f;
      box-shadow:none;
      border: 1px solid rgba(0,0,0,.06);
      font-weight: 700;
    }
    button.ghost{
      background: transparent;
      color: var(--pink);
      box-shadow: none;
      border: 1px solid rgba(255,45,122,.22);
      font-weight: 800;
    }
    .progress{
      background: rgba(255,45,122,.12);
      border-radius: 999px;
      height: 14px;
      overflow:hidden;
      border: 1px solid rgba(255,45,122,.18);
      margin: 10px 0 6px;
    }
    .bar{
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--pink) 0%, var(--pink2) 100%);
      transition: .25s ease;
    }
    .small{ font-size: 12px; color: var(--muted); }
    .strong{ font-weight: 800; color: #1a1a1a; }
    .divider{ height:1px; background: rgba(0,0,0,.06); margin: 12px 0; }
    .chips{ display:flex; flex-wrap:wrap; gap:8px; margin-top: 8px; }
    .chip{
      padding: 8px 10px;
      border-radius: 999px;
      font-size: 12px;
      background: rgba(255,45,122,.10);
      color: var(--pink);
      border: 1px solid rgba(255,45,122,.16);
      font-weight: 700;
    }
    .nav{
      position: fixed; left: 0; right: 0; bottom: 0;
      background: rgba(255,255,255,.92);
      backdrop-filter: blur(10px);
      border-top: 1px solid rgba(0,0,0,.08);
      padding: 10px 10px 12px;
      z-index: 999;
    }
    .navInner{
      max-width: 980px;
      margin: 0 auto;
      display:flex;
      justify-content:space-around;
      gap: 8px;
      flex-wrap: wrap;
    }
    .navBtn{
      flex: 1;
      text-align:center;
      padding: 10px 8px;
      border-radius: 14px;
      border: 1px solid rgba(0,0,0,.06);
      background: rgba(0,0,0,.02);
      color: #1b1b1b;
      font-weight: 900;
      font-size: 12px;
      cursor:pointer;
      user-select:none;
      min-width: 110px;
    }
    .navBtn.active{
      background: linear-gradient(135deg, var(--pink) 0%, var(--pink2) 100%);
      color: white;
      border-color: rgba(255,45,122,.25);
      box-shadow: 0 12px 28px rgba(255,45,122,.22);
    }
    .section{ display:none; }
    .section.active{ display:block; }

    /* prote√≠na - linha por item */
    .protItem{
      border: 1px solid rgba(0,0,0,.06);
      border-radius: 16px;
      padding: 10px;
      background: #fff;
    }
    .protTop{
      display:flex;
      justify-content: space-between;
      align-items:center;
      gap:10px;
      margin-bottom: 8px;
    }
    .toggle{
      display:flex; align-items:center; gap:8px;
      padding: 8px 10px;
      border-radius: 999px;
      background: rgba(255,45,122,.09);
      border: 1px solid rgba(255,45,122,.16);
      color: var(--pink);
      font-weight: 800;
      font-size: 12px;
      cursor:pointer;
      user-select:none;
    }
    .toggle input{ width:18px; height:18px; }
    .protOut{
      margin-top: 6px;
      font-size: 12px;
      color: var(--muted);
    }
    .protOut b{ color:#1a1a1a; }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo">üçë</div>
        <div>
          <h1>Projeto Ampulheta da <span style="color:var(--pink)">Miri√£</span></h1>
          <div class="subtitle">Treino + medidas + √°gua + intestino + prote√≠na</div>
        </div>
      </div>
      <div class="pill">‚ú® Vers√£o App</div>
    </header>

    <!-- SE√á√ïES -->
    <div class="card section active" id="secAgua">
      <div class="cardHead">
        <div>
          <h2 class="cardTitle">üíß √Ågua (ml)</h2>
          <p class="cardNote">Voc√™ soma manualmente e v√™ a m√©dia dos √∫ltimos 7 dias.</p>
        </div>
        <div class="chips">
          <span class="chip">üìä 7 dias</span>
          <span class="chip">‚úÖ Meta</span>
        </div>
      </div>

      <div class="cardBody">
        <div class="row row2">
          <div>
            <label>üéØ Meta di√°ria (ml)</label>
            <input type="number" id="metaAgua" value="2500" />
          </div>
          <div>
            <label>‚ûï Adicionar manualmente (ml)</label>
            <input type="number" id="aguaManual" placeholder="Ex: 300" />
          </div>
        </div>

        <div class="btnRow">
          <button onclick="addManual()">‚ûï Somar</button>
          <button class="ghost" onclick="addAgua(470)">+470 ml</button>
          <button class="ghost" onclick="addAgua(250)">+250 ml</button>
          <button class="secondary" onclick="desfazerAgua()">‚Ü©Ô∏è Desfazer</button>
          <button class="secondary" onclick="zerarAgua()">üßπ Zerar hoje</button>
        </div>

        <div class="progress"><div class="bar" id="barAgua"></div></div>
        <div id="statusAgua" class="small"></div>
        <div id="media7" class="small"></div>
      </div>
    </div>

    <!-- PROTE√çNA (DO JEITO QUE VOC√ä QUER) -->
    <div class="card section" id="secProteina" style="margin-top:12px;">
      <div class="cardHead">
        <div>
          <h2 class="cardTitle">üçΩÔ∏è Prote√≠na autom√°tica (voc√™ escolhe + digita quantidade)</h2>
          <p class="cardNote">Marque o que voc√™ comeu hoje e informe a quantidade. O app soma sozinho.</p>
        </div>
        <div class="chips">
          <span class="chip">üéØ Meta</span>
          <span class="chip">‚ûï Soma</span>
        </div>
      </div>

      <div class="cardBody">
        <div class="row row2">
          <div>
            <label>üéØ Meta de prote√≠na (g/dia)</label>
            <input type="number" id="metaProt" value="100" />
          </div>
          <div>
            <label>üìÖ Hoje</label>
            <input type="text" id="dataProt" disabled />
          </div>
        </div>

        <div class="divider"></div>

        <!-- Itens -->
        <div class="row row2">
          <!-- Frango -->
          <div class="protItem">
            <div class="protTop">
              <div class="strong">üçó Frango</div>
              <label class="toggle" style="margin:0;">
                <input type="checkbox" id="useFrango" onchange="calcProteinaLive()">
                usar
              </label>
            </div>
            <label>Quantidade (g)</label>
            <input type="number" id="qFrango" placeholder="Ex: 150" oninput="calcProteinaLive()" />
            <div class="protOut">Regra: <b>31g</b> a cada <b>100g</b> ‚Ä¢ Prote√≠na: <b id="outFrango">0g</b></div>
          </div>

          <!-- Carne -->
          <div class="protItem">
            <div class="protTop">
              <div class="strong">ü•© Carne</div>
              <label class="toggle" style="margin:0;">
                <input type="checkbox" id="useCarne" onchange="calcProteinaLive()">
                usar
              </label>
            </div>
            <label>Quantidade (g)</label>
            <input type="number" id="qCarne" placeholder="Ex: 120" oninput="calcProteinaLive()" />
            <div class="protOut">Regra: <b>26g</b> a cada <b>100g</b> ‚Ä¢ Prote√≠na: <b id="outCarne">0g</b></div>
          </div>
        </div>

        <div class="row row2">
          <!-- Ovo -->
          <div class="protItem">
            <div class="protTop">
              <div class="strong">ü•ö Ovo</div>
              <label class="toggle" style="margin:0;">
                <input type="checkbox" id="useOvo" onchange="calcProteinaLive()">
                usar
              </label>
            </div>
            <label>Quantidade (unidades)</label>
            <input type="number" id="qOvo" placeholder="Ex: 2" oninput="calcProteinaLive()" />
            <div class="protOut">Regra: <b>6g</b> por unidade ‚Ä¢ Prote√≠na: <b id="outOvo">0g</b></div>
          </div>

          <!-- Iogurte -->
          <div class="protItem">
            <div class="protTop">
              <div class="strong">ü•õ Iogurte</div>
              <label class="toggle" style="margin:0;">
                <input type="checkbox" id="useIog" onchange="calcProteinaLive()">
                usar
              </label>
            </div>
            <label>Quantidade (unidade)</label>
            <input type="number" id="qIog" placeholder="Ex: 1" oninput="calcProteinaLive()" />
            <div class="protOut">Regra: <b>10g</b> por unidade ‚Ä¢ Prote√≠na: <b id="outIog">0g</b></div>
          </div>
        </div>

        <div class="row row2">
          <!-- Queijo -->
          <div class="protItem">
            <div class="protTop">
              <div class="strong">üßÄ Queijo</div>
              <label class="toggle" style="margin:0;">
                <input type="checkbox" id="useQueijo" onchange="calcProteinaLive()">
                usar
              </label>
            </div>
            <label>Quantidade (g)</label>
            <input type="number" id="qQueijo" placeholder="Ex: 30" oninput="calcProteinaLive()" />
            <div class="protOut">Regra: <b>25g</b> a cada <b>100g</b> ‚Ä¢ Prote√≠na: <b id="outQueijo">0g</b></div>
          </div>

          <!-- Whey -->
          <div class="protItem">
            <div class="protTop">
              <div class="strong">ü•§ Whey</div>
              <label class="toggle" style="margin:0;">
                <input type="checkbox" id="useWhey" onchange="calcProteinaLive()">
                usar
              </label>
            </div>
            <label>Quantidade (scoop)</label>
            <input type="number" id="qWhey" placeholder="Ex: 1" oninput="calcProteinaLive()" />
            <div class="protOut">Regra: <b>20g</b> por scoop ‚Ä¢ Prote√≠na: <b id="outWhey">0g</b></div>
          </div>
        </div>

        <div class="divider"></div>

        <div class="btnRow">
          <button onclick="salvarProteinaHoje()">üíæ Salvar prote√≠na do dia</button>
          <button class="secondary" onclick="limparProteina()">üßπ Limpar tudo</button>
        </div>

        <div class="progress"><div class="bar" id="barProt"></div></div>
        <div id="statusProt" class="small"></div>
        <div id="histProt" class="small"></div>
      </div>
    </div>

    <!-- INTESTINO -->
    <div class="card section" id="secIntestino" style="margin-top:12px;">
      <div class="cardHead">
        <div>
          <h2 class="cardTitle">üöΩ Intestino + Chia</h2>
          <p class="cardNote">Acompanhar se √°gua morna + chia est√° ajudando.</p>
        </div>
        <div class="chips">
          <span class="chip">üåø chia</span>
          <span class="chip">üóìÔ∏è di√°rio</span>
        </div>
      </div>

      <div class="cardBody">
        <div class="row row2">
          <div>
            <label>Hoje fui ao banheiro?</label>
            <select id="intestinoSel">
              <option value="nao">N√£o</option>
              <option value="sim">Sim</option>
              <option value="pouco">Pouquinho</option>
            </select>
          </div>
          <div>
            <label>
              <input type="checkbox" id="chiaCheck" style="width:18px;height:18px;vertical-align:middle;">
              Tomei √°gua morna + chia (10 min em jejum)
            </label>
          </div>
        </div>

        <div class="btnRow">
          <button onclick="salvarIntestino()">üíæ Salvar</button>
          <button class="secondary" onclick="limparIntestinoHoje()">üßπ Limpar hoje</button>
        </div>

        <div id="historicoIntestino" class="small" style="margin-top:10px;"></div>
      </div>
    </div>

  </div>

  <!-- MENU -->
  <div class="nav">
    <div class="navInner">
      <div class="navBtn active" data-go="secAgua">üíß √Ågua</div>
      <div class="navBtn" data-go="secProteina">üçΩÔ∏è Prote√≠na</div>
      <div class="navBtn" data-go="secIntestino">üöΩ Intestino</div>
    </div>
  </div>

<script>
  // ===== PWA SW (se tiver sw.js no repo, ele registra) =====
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker.register("./sw.js").catch(()=>{});
    });
  }

  // ===== UTIL =====
  function hoje(){ return new Date().toISOString().split("T")[0]; }
  function fmtDataBR(iso){ const [y,m,d] = iso.split("-"); return `${d}/${m}/${y}`; }
  function clamp(n,min,max){ return Math.max(min, Math.min(max,n)); }

  // ===== STORAGE =====
  let dados = JSON.parse(localStorage.getItem("app_miria_ampulheta")) || {
    agua: {},
    intestino: {},
    proteina: {}
  };
  function salvarAll(){ localStorage.setItem("app_miria_ampulheta", JSON.stringify(dados)); }

  // ===== NAV =====
  document.querySelectorAll(".navBtn").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      document.querySelectorAll(".navBtn").forEach(b=>b.classList.remove("active"));
      btn.classList.add("active");
      const id = btn.getAttribute("data-go");
      document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
      document.getElementById(id).classList.add("active");
    });
  });

  // ===== √ÅGUA =====
  if(!dados.agua[hoje()]) dados.agua[hoje()] = {total:0, pilha:[]};

  function atualizarAgua(){
    const meta = Number(document.getElementById("metaAgua").value || 0);
    const total = (dados.agua[hoje()]?.total) || 0;

    document.getElementById("statusAgua").innerHTML =
      `üíß Hoje: <b>${total} ml</b> ‚Ä¢ Meta: <b>${meta} ml</b>`;

    let pct = meta>0 ? (total/meta)*100 : 0;
    pct = clamp(pct, 0, 100);
    document.getElementById("barAgua").style.width = pct + "%";

    let soma = 0, dias = 0;
    for(let i=0;i<7;i++){
      const d = new Date(); d.setDate(d.getDate()-i);
      const key = d.toISOString().split("T")[0];
      if(dados.agua[key]){ soma += dados.agua[key].total || 0; dias++; }
    }
    const media = dias ? Math.round(soma/dias) : 0;
    document.getElementById("media7").innerHTML = `üìä M√©dia √∫ltimos 7 dias: <b>${media} ml</b>`;
    salvarAll();
  }
  document.getElementById("metaAgua").addEventListener("input", atualizarAgua);

  function addAgua(valor){
    if(!dados.agua[hoje()]) dados.agua[hoje()] = {total:0, pilha:[]};
    dados.agua[hoje()].total += valor;
    dados.agua[hoje()].pilha.push(valor);
    salvarAll(); atualizarAgua();
  }
  function addManual(){
    const val = Number(document.getElementById("aguaManual").value);
    if(val > 0){
      addAgua(val);
      document.getElementById("aguaManual").value = "";
    }
  }
  function desfazerAgua(){
    const stack = dados.agua[hoje()]?.pilha || [];
    const ultimo = stack.pop();
    if(ultimo){
      dados.agua[hoje()].total -= ultimo;
      if(dados.agua[hoje()].total < 0) dados.agua[hoje()].total = 0;
    }
    salvarAll(); atualizarAgua();
  }
  function zerarAgua(){
    dados.agua[hoje()] = {total:0, pilha:[]};
    salvarAll(); atualizarAgua();
  }

  // ===== INTESTINO =====
  function salvarIntestino(){
    dados.intestino[hoje()] = {
      foi: document.getElementById("intestinoSel").value,
      chia: document.getElementById("chiaCheck").checked
    };
    salvarAll(); atualizarIntestino();
  }
  function limparIntestinoHoje(){
    delete dados.intestino[hoje()];
    salvarAll(); atualizarIntestino();
  }
  function atualizarIntestino(){
    const entries = Object.entries(dados.intestino).sort((a,b)=> b[0].localeCompare(a[0])).slice(0,10);
    const html = entries.map(([data,val])=>{
      const foiTxt = val.foi === "sim" ? "‚úÖ Sim" : (val.foi==="pouco" ? "üü° Pouquinho" : "‚ùå N√£o");
      const chiaTxt = val.chia ? " + üåø chia" : "";
      return `<b>${fmtDataBR(data)}</b> ‚Äî ${foiTxt}${chiaTxt}`;
    }).join("<br>");
    document.getElementById("historicoIntestino").innerHTML = html || "Sem registros ainda.";

    if(dados.intestino[hoje()]){
      document.getElementById("intestinoSel").value = dados.intestino[hoje()].foi;
      document.getElementById("chiaCheck").checked = !!dados.intestino[hoje()].chia;
    } else {
      document.getElementById("intestinoSel").value = "nao";
      document.getElementById("chiaCheck").checked = false;
    }
  }

  // ===== PROTE√çNA (ESCOLHER + QUANTIDADE + SOMA) =====
  document.getElementById("dataProt").value = fmtDataBR(hoje());

  const fatores = {
    frango: { tipo:"g",  por:100, prot:31 }, // 31g a cada 100g
    carne:  { tipo:"g",  por:100, prot:26 },
    ovo:    { tipo:"un", por:1,   prot:6  },
    iog:    { tipo:"un", por:1,   prot:10 },
    queijo: { tipo:"g",  por:100, prot:25 },
    whey:   { tipo:"sc", por:1,   prot:20 }
  };

  function calcItem(qtd, cfg){
    qtd = Number(qtd || 0);
    if(qtd <= 0) return 0;
    if(cfg.por === 1) return qtd * cfg.prot;
    return (qtd / cfg.por) * cfg.prot;
  }

  function calcProteinaLive(){
    // s√≥ soma se estiver marcado "usar"
    const useFrango = document.getElementById("useFrango").checked;
    const useCarne  = document.getElementById("useCarne").checked;
    const useOvo    = document.getElementById("useOvo").checked;
    const useIog    = document.getElementById("useIog").checked;
    const useQueijo = document.getElementById("useQueijo").checked;
    const useWhey   = document.getElementById("useWhey").checked;

    const qFrango = document.getElementById("qFrango").value;
    const qCarne  = document.getElementById("qCarne").value;
    const qOvo    = document.getElementById("qOvo").value;
    const qIog    = document.getElementById("qIog").value;
    const qQueijo = document.getElementById("qQueijo").value;
    const qWhey   = document.getElementById("qWhey").value;

    const pFrango = useFrango ? calcItem(qFrango, fatores.frango) : 0;
    const pCarne  = useCarne  ? calcItem(qCarne,  fatores.carne)  : 0;
    const pOvo    = useOvo    ? calcItem(qOvo,    fatores.ovo)    : 0;
    const pIog    = useIog    ? calcItem(qIog,    fatores.iog)    : 0;
    const pQueijo = useQueijo ? calcItem(qQueijo, fatores.queijo) : 0;
    const pWhey   = useWhey   ? calcItem(qWhey,   fatores.whey)   : 0;

    document.getElementById("outFrango").innerText = Math.round(pFrango) + "g";
    document.getElementById("outCarne").innerText  = Math.round(pCarne)  + "g";
    document.getElementById("outOvo").innerText    = Math.round(pOvo)    + "g";
    document.getElementById("outIog").innerText    = Math.round(pIog)    + "g";
    document.getElementById("outQueijo").innerText = Math.round(pQueijo) + "g";
    document.getElementById("outWhey").innerText   = Math.round(pWhey)   + "g";

    const total = Math.round(pFrango + pCarne + pOvo + pIog + pQueijo + pWhey);
    const meta = Number(document.getElementById("metaProt").value || 0);
    const falta = meta - total;

    const pct = meta>0 ? clamp((total/meta)*100, 0, 100) : 0;
    document.getElementById("barProt").style.width = pct + "%";

    document.getElementById("statusProt").innerHTML =
      `Prote√≠na hoje: <b>${total}g</b> ‚Ä¢ Meta: <b>${meta}g</b> ‚Ä¢ ` +
      (falta>0 ? `Faltam <b>${falta}g</b>` : `<b>Meta batida! üî•</b>`);
  }

  function salvarProteinaHoje(){
    // salva o que foi marcado + quantidades + total
    const meta = Number(document.getElementById("metaProt").value || 0);

    const payload = {
      meta,
      useFrango: document.getElementById("useFrango").checked,
      useCarne:  document.getElementById("useCarne").checked,
      useOvo:    document.getElementById("useOvo").checked,
      useIog:    document.getElementById("useIog").checked,
      useQueijo: document.getElementById("useQueijo").checked,
      useWhey:   document.getElementById("useWhey").checked,
      qFrango: Number(document.getElementById("qFrango").value||0),
      qCarne:  Number(document.getElementById("qCarne").value||0),
      qOvo:    Number(document.getElementById("qOvo").value||0),
      qIog:    Number(document.getElementById("qIog").value||0),
      qQueijo: Number(document.getElementById("qQueijo").value||0),
      qWhey:   Number(document.getElementById("qWhey").value||0),
    };

    // calcula total igual ao live
    const pFrango = payload.useFrango ? calcItem(payload.qFrango, fatores.frango) : 0;
    const pCarne  = payload.useCarne  ? calcItem(payload.qCarne,  fatores.carne)  : 0;
    const pOvo    = payload.useOvo    ? calcItem(payload.qOvo,    fatores.ovo)    : 0;
    const pIog    = payload.useIog    ? calcItem(payload.qIog,    fatores.iog)    : 0;
    const pQueijo = payload.useQueijo ? calcItem(payload.qQueijo, fatores.queijo) : 0;
    const pWhey   = payload.useWhey   ? calcItem(payload.qWhey,   fatores.whey)   : 0;

    payload.total = Math.round(pFrango+pCarne+pOvo+pIog+pQueijo+pWhey);

    dados.proteina[hoje()] = payload;
    salvarAll();
    atualizarHistoricoProteina();
    calcProteinaLive();
  }

  function limparProteina(){
    ["useFrango","useCarne","useOvo","useIog","useQueijo","useWhey"].forEach(id=>document.getElementById(id).checked=false);
    ["qFrango","qCarne","qOvo","qIog","qQueijo","qWhey"].forEach(id=>document.getElementById(id).value="");
    calcProteinaLive();
  }

  function carregarProteinaHoje(){
    const reg = dados.proteina[hoje()];
    if(!reg) { calcProteinaLive(); atualizarHistoricoProteina(); return; }

    document.getElementById("metaProt").value = reg.meta || 100;

    document.getElementById("useFrango").checked = !!reg.useFrango;
    document.getElementById("useCarne").checked  = !!reg.useCarne;
    document.getElementById("useOvo").checked    = !!reg.useOvo;
    document.getElementById("useIog").checked    = !!reg.useIog;
    document.getElementById("useQueijo").checked = !!reg.useQueijo;
    document.getElementById("useWhey").checked   = !!reg.useWhey;

    document.getElementById("qFrango").value = reg.qFrango || "";
    document.getElementById("qCarne").value  = reg.qCarne  || "";
    document.getElementById("qOvo").value    = reg.qOvo    || "";
    document.getElementById("qIog").value    = reg.qIog    || "";
    document.getElementById("qQueijo").value = reg.qQueijo || "";
    document.getElementById("qWhey").value   = reg.qWhey   || "";

    calcProteinaLive();
    atualizarHistoricoProteina();
  }

  function atualizarHistoricoProteina(){
    const entries = Object.entries(dados.proteina).sort((a,b)=> b[0].localeCompare(a[0])).slice(0,7);
    document.getElementById("histProt").innerHTML = entries.length ? entries.map(([data,val])=>{
      const ok = (val.total||0) >= (val.meta||0) && (val.meta||0) > 0;
      return `${ok ? "‚úÖ" : "‚è≥"} <b>${fmtDataBR(data)}</b> ‚Äî ${val.total||0}g (meta ${val.meta||0}g)`;
    }).join("<br>") : "Sem hist√≥rico ainda.";
  }

  // ===== INIT =====
  function init(){
    atualizarAgua();
    atualizarIntestino();
    carregarProteinaHoje();
  }
  init();
</script>
</body>
</html>
