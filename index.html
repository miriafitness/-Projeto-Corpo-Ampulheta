<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ğŸ‘ Projeto Ampulheta da MiriÃ£</title>
  <meta name="theme-color" content="#ff2d83" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <style>
    :root{
      --bg1:#ffe1ee;
      --bg2:#fff4f9;
      --card:#ffffff;
      --pink:#ff2d83;
      --pink2:#ff5aa5;
      --text:#1c1c1c;
      --muted:#6b6b6b;
      --line:#f1cddd;
      --ok:#16a34a;
      --warn:#f59e0b;
      --shadow:0 12px 34px rgba(0,0,0,.08);
      --r:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 380px at 50% 0%, var(--bg1), transparent 60%),
        linear-gradient(180deg, var(--bg2), #ffffff 55%);
    }
    .wrap{max-width:1100px;margin:0 auto;padding:18px}
    header{
      display:flex;gap:12px;align-items:flex-start;justify-content:space-between;
      margin:10px 0 14px;
    }
    .brand h1{margin:0;font-size:28px;letter-spacing:-.6px}
    .brand p{margin:6px 0 0;color:var(--muted);font-size:13px}
    .pill{
      display:inline-flex;align-items:center;gap:8px;
      padding:10px 12px;border-radius:999px;background:#fff;
      border:1px solid var(--line); box-shadow:0 6px 16px rgba(0,0,0,.05);
      font-size:13px;color:var(--muted);
      max-width:420px;
    }

    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:14px}
    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--r);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .hd{
      padding:14px 14px 10px;
      display:flex;align-items:flex-start;justify-content:space-between;gap:10px;
      border-bottom:1px solid #f7e8f0;
      background:linear-gradient(180deg,#fff, #fff6fb);
    }
    .hd h2{margin:0;font-size:16px}
    .hd small{color:var(--muted)}
    .bd{padding:14px}
    .badge{
      display:inline-flex;align-items:center;gap:6px;
      font-size:12px;padding:6px 10px;border-radius:999px;
      background:#fff;border:1px solid var(--line); color:var(--muted);
      white-space:nowrap;
    }

    .btnrow{display:flex;flex-wrap:wrap;gap:10px}
    .btn{
      border:0;cursor:pointer;
      padding:11px 12px;border-radius:14px;
      background:linear-gradient(135deg,var(--pink),var(--pink2));
      color:#fff;font-weight:800;
      transition:.15s transform, .15s opacity;
      font-family:inherit;
    }
    .btn:active{transform:scale(.98)}
    .btn:hover{opacity:.95}
    .btn-ghost{
      background:#fff;color:var(--pink);
      border:1px solid var(--line);
    }
    .btn-warn{
      background:#fff7ed;color:#9a3412;
      border:1px solid #fed7aa;font-weight:900;
    }

    .kpi{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-top:8px}
    .box{
      background:#fff;border:1px solid var(--line);
      border-radius:16px;padding:10px;
    }
    .box b{display:block;font-size:16px}
    .box span{color:var(--muted);font-size:12px}

    @media(max-width:900px){ .kpi{grid-template-columns:repeat(2,1fr)} }
    @media(max-width:560px){
      header{flex-direction:column;align-items:flex-start}
      .kpi{grid-template-columns:1fr}
    }

    .tabs{display:flex;gap:10px;flex-wrap:wrap}
    .tab{
      padding:10px 12px;border-radius:999px;
      border:1px solid var(--line); background:#fff;
      font-weight:900; cursor:pointer;
    }
    .tab.active{
      border-color:transparent;
      background:linear-gradient(135deg,var(--pink),var(--pink2));
      color:#fff;
    }

    .list{display:flex;flex-direction:column;gap:10px}
    .item{
      border:1px solid var(--line);
      border-radius:16px;
      padding:12px;background:#fff;
    }
    .item .top{display:flex;align-items:center;justify-content:space-between;gap:10px}
    .item .top b{font-size:14px}
    .meta{color:var(--muted);font-size:12px;margin-top:6px;line-height:1.35}
    a{color:var(--pink);font-weight:900;text-decoration:none}
    a:hover{text-decoration:underline}

    .two{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media(max-width:820px){ .two{grid-template-columns:1fr} }

    .row{display:grid;grid-template-columns:1fr 140px 140px;gap:10px;margin-top:10px}
    @media(max-width:560px){
      .row{grid-template-columns:1fr 1fr}
      .row .full{grid-column:1/-1}
    }

    input, select, textarea{
      width:100%;
      padding:10px 11px;border-radius:14px;
      border:1px solid var(--line);
      font-family:inherit; background:#fff;
      outline:none;
    }
    textarea{min-height:92px;resize:vertical}

    .hint{color:var(--muted);font-size:12px;margin-top:6px}
    .hr{height:1px;background:#f7e8f0;margin:12px 0}
    .toast{display:none;margin-top:10px;color:var(--ok);font-weight:900;font-size:12px}

    .photoGrid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
    @media(max-width:820px){ .photoGrid{grid-template-columns:repeat(2,1fr)} }
    .photoCard{
      border:1px solid var(--line);border-radius:16px;overflow:hidden;background:#fff;
    }
    .photoCard img{width:100%;height:180px;object-fit:cover;display:block}
    .photoCard .cap{padding:10px}
    .cap b{display:block;font-size:13px}
    .cap span{display:block;font-size:12px;color:var(--muted);margin-top:4px}
    .cap .mini{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .cap .mini button{padding:8px 10px;border-radius:12px;font-weight:900}
    .footer{margin:18px 0 6px;color:var(--muted);font-size:12px}
  </style>
</head>

<body>
<div class="wrap">
  <header>
    <div class="brand">
      <h1>ğŸ‘ Projeto Ampulheta da MiriÃ£</h1>
      <p>Treino + glÃºteo + cintura marcada â³ â€¢ intestino regulado ğŸš½ â€¢ progresso com registro ğŸ“Š</p>
    </div>
    <div class="pill" id="statusPill">âœ¨ Hoje Ã© dia de evoluir com calma e constÃ¢ncia, MiriÃ£ ğŸ’›</div>
  </header>

  <div class="grid">

    <!-- MENU -->
    <div class="card" style="grid-column:span 12">
      <div class="hd">
        <div>
          <h2>ğŸ“Œ Menu rÃ¡pido</h2>
          <small>Clique e vÃ¡ para a seÃ§Ã£o</small>
        </div>
        <div class="badge">âœ¨ v3 â€¢ metas + calculadora + fotos</div>
      </div>
      <div class="bd btnrow">
        <button class="btn" onclick="go('painel')">ğŸ’– Painel</button>
        <button class="btn" onclick="go('treinos')">ğŸ‹ï¸ Treinos</button>
        <button class="btn" onclick="go('registrar')">ğŸ§¾ Cargas</button>
        <button class="btn" onclick="go('medidas')">ğŸ“ Medidas</button>
        <button class="btn" onclick="go('intestino')">ğŸš½ Intestino</button>
        <button class="btn" onclick="go('metaSemanal')">ğŸ¯ Metas</button>
        <button class="btn" onclick="go('calc')">ğŸ§® ProgressÃ£o</button>
        <button class="btn" onclick="go('fotos')">ğŸ“¸ Antes/Depois</button>
        <button class="btn-ghost btn" onclick="go('backup')">ğŸ›¡ï¸ Backup</button>
      </div>
    </div>

    <!-- PAINEL -->
    <div class="card" id="painel" style="grid-column:span 12">
      <div class="hd">
        <div>
          <h2>ğŸ’– Painel de controle</h2>
          <small>Seu resumo + evoluÃ§Ã£o</small>
        </div>
        <div class="badge">Objetivo: ğŸ‘ glÃºteo + â³ cintura â€œBâ€</div>
      </div>
      <div class="bd">
        <div class="kpi">
          <div class="box"><b id="kpiPeso">â€”</b><span>Peso atual</span></div>
          <div class="box"><b id="kpiCintura">â€”</b><span>Cintura</span></div>
          <div class="box"><b id="kpiAbdomen">â€”</b><span>AbdÃ´men</span></div>
          <div class="box"><b id="kpiGluteo">â€”</b><span>GlÃºteo</span></div>
        </div>

        <div class="hr"></div>

        <div class="two">
          <div class="card" style="box-shadow:none">
            <div class="bd">
              <b>ğŸ“ˆ Medidas (Ãºltimos check-ins)</b>
              <canvas id="chartMeasures" height="165"></canvas>
              <div class="hint">Dica: mede 1x por semana (domingo de manhÃ£) âœ”</div>
            </div>
          </div>

          <div class="card" style="box-shadow:none">
            <div class="bd">
              <b>ğŸ“ˆ ExercÃ­cio (carga + reps)</b>
              <select id="chartSelect" style="margin:8px 0"></select>
              <canvas id="chartExercise" height="165"></canvas>
              <div class="hint">Acompanhe principalmente: Hip Thrust, Leg Press, Smith.</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- TREINOS -->
    <div class="card" id="treinos" style="grid-column:span 12">
      <div class="hd">
        <div>
          <h2>ğŸ‹ï¸ Treinos (Ampulheta) ğŸ‘â³</h2>
          <small>Descanso: <b>1m30</b> principais â€¢ <b>45â€“60s</b> acessÃ³rios</small>
        </div>
        <div class="badge">âœ¨ Peito/ombro p/ colo + costas p/ cintura</div>
      </div>
      <div class="bd">
        <div class="tabs" id="tabs">
          <div class="tab active" data-tab="seg">ğŸ“… Segunda â€¢ Posterior/GlÃºteo</div>
          <div class="tab" data-tab="ter">âœ¨ TerÃ§a â€¢ Peito/Ombro</div>
          <div class="tab" data-tab="qua">ğŸ‘ Quarta â€¢ QuadrÃ­ceps/GlÃºteo</div>
          <div class="tab" data-tab="qui">ğŸ’ª Quinta â€¢ Costas/Postura</div>
          <div class="tab" data-tab="sex">ğŸ”¥ Sexta â€¢ GlÃºteo Foco</div>
          <div class="tab" data-tab="pro">ğŸ“ˆ ProgressÃ£o 8 semanas</div>
        </div>

        <div class="hr"></div>

        <div id="tab-seg" class="tabpage">
          <h3>ğŸ“… SEGUNDA â€“ GLÃšTEO / POSTERIOR ğŸ‘ğŸ”¥</h3>
          <div class="list" id="list-seg"></div>
          <div class="hint">ğŸ¯ Meta: sentir glÃºteo trabalhando, sem roubar com lombar.</div>
        </div>

        <div id="tab-ter" class="tabpage" style="display:none">
          <h3>âœ¨ TERÃ‡A â€“ PEITO + OMBRO (FIRMEZA DO COLO) ğŸ’—</h3>
          <div class="list" id="list-ter"></div>
          <div class="hint">ğŸ’¡ Isso melhora aparÃªncia do colo + postura (nÃ£o â€œlevantaâ€ pele, mas melhora MUITO o visual).</div>
        </div>

        <div id="tab-qua" class="tabpage" style="display:none">
          <h3>ğŸ‘ QUARTA â€“ QUADRÃCEPS + GLÃšTEO ğŸ”¥</h3>
          <div class="list" id="list-qua"></div>
        </div>

        <div id="tab-qui" class="tabpage" style="display:none">
          <h3>ğŸ’ª QUINTA â€“ COSTAS + POSTURA â³âœ¨</h3>
          <div class="list" id="list-qui"></div>
          <div class="hint">â³ Cintura mais marcada = costas fortes + postura + core profundo.</div>
        </div>

        <div id="tab-sex" class="tabpage" style="display:none">
          <h3>ğŸ”¥ SEXTA â€“ GLÃšTEO FOCO PESADO ğŸ‘</h3>
          <div class="list" id="list-sex"></div>
          <div class="hint">ğŸ“Œ Regra: boa forma + progressÃ£o. Dor forte nÃ£o Ã© meta.</div>
        </div>

        <div id="tab-pro" class="tabpage" style="display:none">
          <h3>ğŸ“ˆ PROGRESSÃƒO 8 SEMANAS (GLÃšTEO MAIS RÃPIDO) ğŸ”¥</h3>
          <div class="list">
            <div class="item">
              <div class="top"><b>Semanas 1â€“2</b><span class="badge">tÃ©cnica</span></div>
              <div class="meta">âœ… Aprender execuÃ§Ã£o perfeita â€¢ âœ… sentir glÃºteo â€¢ âœ… registrar cargas.</div>
            </div>
            <div class="item">
              <div class="top"><b>Semanas 3â€“4</b><span class="badge">+ carga</span></div>
              <div class="meta">ğŸ“Œ Se bateu reps com forma boa â†’ <b>sobe 2kg</b> nos principais.</div>
            </div>
            <div class="item">
              <div class="top"><b>Semanas 5â€“6</b><span class="badge">intensidade</span></div>
              <div class="meta">ğŸ”¥ Ãšltima sÃ©rie â€œquase falhaâ€ (sem perder tÃ©cnica).</div>
            </div>
            <div class="item">
              <div class="top"><b>Semanas 7â€“8</b><span class="badge">pesado</span></div>
              <div class="meta">ğŸ‘ Trabalhar 8 reps mais pesado nos principais (Hip Thrust/Leg Press/Smith).</div>
            </div>
            <div class="item">
              <div class="top"><b>Regra de ouro</b><span class="badge">sempre</span></div>
              <div class="meta">Se fizer tudo â€œfÃ¡cilâ€ â†’ sobe peso. Se nÃ£o fizer 8 reps â†’ pesado demais.</div>
            </div>
          </div>
        </div>

        <div class="footer">Feito pra vocÃª ğŸ’› â€¢ Treino inteligente + registro = resultado real.</div>
      </div>
    </div>

    <!-- REGISTRAR CARGAS -->
    <div class="card" id="registrar" style="grid-column:span 12">
      <div class="hd">
        <div>
          <h2>ğŸ§¾ Registrar cargas (histÃ³rico por exercÃ­cio)</h2>
          <small>ğŸ“Œ Seu crescimento vem daqui</small>
        </div>
        <div class="badge">âœ… bateu reps â†’ sobe peso</div>
      </div>
      <div class="bd">
        <div class="two">
          <div>
            <label><b>ExercÃ­cio</b></label>
            <select id="exSelect"></select>
            <div class="hint">Escolha o exercÃ­cio e registre seu melhor set do dia.</div>
          </div>
          <div>
            <label><b>Data</b></label>
            <input id="exDate" type="date"/>
          </div>
        </div>

        <div class="row">
          <div class="full">
            <label><b>ObservaÃ§Ã£o (opcional)</b></label>
            <input id="exObs" placeholder="Ex.: senti mais glÃºteo / ajustar pÃ©s / doeu pouco..." />
          </div>
          <div>
            <label><b>Carga (kg)</b></label>
            <input id="exKg" type="number" step="0.5" placeholder="Ex.: 18" />
          </div>
          <div>
            <label><b>Reps</b></label>
            <input id="exReps" type="number" step="1" placeholder="Ex.: 12" />
          </div>
        </div>

        <div class="btnrow" style="margin-top:12px">
          <button class="btn" onclick="saveSet()">Salvar registro âœ…</button>
          <button class="btn-ghost btn" onclick="clearForm()">Limpar</button>
        </div>
        <div id="toastSet" class="toast">Registro salvo!</div>

        <div class="hr"></div>
        <h3>ğŸ“š HistÃ³rico do exercÃ­cio</h3>
        <div id="historyBox" class="list"></div>
      </div>
    </div>

    <!-- MEDIDAS -->
    <div class="card" id="medidas" style="grid-column:span 12">
      <div class="hd">
        <div>
          <h2>ğŸ“ Medidas + Check-in semanal</h2>
          <small>Registre 1x por semana</small>
        </div>
        <div class="badge">ğŸ’– ampulheta Ã© consistÃªncia</div>
      </div>
      <div class="bd">
        <div class="row">
          <div class="full">
            <label><b>Data</b></label>
            <input id="mDate" type="date"/>
          </div>
          <div>
            <label><b>Peso (kg)</b></label>
            <input id="mPeso" type="number" step="0.1" placeholder="56.9"/>
          </div>
          <div>
            <label><b>Cintura (cm)</b></label>
            <input id="mCintura" type="number" step="0.1" placeholder="72"/>
          </div>
          <div>
            <label><b>AbdÃ´men (cm)</b></label>
            <input id="mAbdomen" type="number" step="0.1" placeholder="81"/>
          </div>
          <div>
            <label><b>GlÃºteo (cm)</b></label>
            <input id="mGluteo" type="number" step="0.1" placeholder="96"/>
          </div>
        </div>

        <div class="btnrow" style="margin-top:12px">
          <button class="btn" onclick="saveMeasures()">Salvar medidas âœ…</button>
          <button class="btn-ghost btn" onclick="renderMeasures()">Atualizar painel</button>
        </div>
        <div id="toastMeasures" class="toast">Medidas salvas!</div>

        <div class="hr"></div>
        <h3>ğŸ“Œ Ãšltimos check-ins</h3>
        <div id="measuresBox" class="list"></div>
      </div>
    </div>

    <!-- INTESTINO -->
    <div class="card" id="intestino" style="grid-column:span 12">
      <div class="hd">
        <div>
          <h2>ğŸš½ Rastreador do intestino</h2>
          <small>Pra vocÃª ver se a chia estÃ¡ ajudando de verdade</small>
        </div>
        <div class="badge">ğŸŒ… jejum + chia</div>
      </div>
      <div class="bd">
        <div class="item">
          <div class="top"><b>ğŸŒ… Rotina da manhÃ£ (jejum)</b><span class="badge">10 min</span></div>
          <div class="meta">
            âœ… 1 copo (200â€“300 ml) de <b>Ã¡gua morna</b> + <b>1 colher de sopa de chia</b> <br/>
            âœ… Deixa hidratar <b>10 minutos</b> e toma devagar.
          </div>
        </div>

        <div class="hr"></div>

        <div class="two">
          <div>
            <label><b>Data</b></label>
            <input id="gDate" type="date"/>
          </div>
          <div>
            <label><b>VocÃª fez Ã¡gua morna + chia?</b></label>
            <select id="gChia">
              <option value="sim">âœ… Sim</option>
              <option value="nao">âŒ NÃ£o</option>
            </select>
          </div>
        </div>

        <div class="two" style="margin-top:10px">
          <div>
            <label><b>Evacuou hoje?</b></label>
            <select id="gEvac">
              <option value="nao">âŒ NÃ£o</option>
              <option value="pouco">âœ… Sim (pouquinho)</option>
              <option value="normal">âœ… Sim (normal)</option>
              <option value="muito">âœ… Sim (muito)</option>
            </select>
          </div>
          <div>
            <label><b>InchaÃ§o no fim do dia</b></label>
            <select id="gInchaco">
              <option value="desinchada">ğŸ’– Desinchada</option>
              <option value="normal">ğŸ™‚ Normal</option>
              <option value="inchada">ğŸ˜£ Inchada</option>
            </select>
          </div>
        </div>

        <div style="margin-top:10px">
          <label><b>ObservaÃ§Ã£o</b></label>
          <input id="gObs" placeholder="Ex.: suco coado, pouca Ã¡gua, estresse, treino pesado..." />
          <div class="hint">ğŸ’¡ Quanto mais vocÃª registra, mais fÃ¡cil ver o padrÃ£o.</div>
        </div>

        <div class="btnrow" style="margin-top:12px">
          <button class="btn" onclick="saveGut()">Salvar hoje âœ…</button>
          <button class="btn-ghost btn" onclick="renderGut()">Atualizar</button>
        </div>
        <div id="toastGut" class="toast">Registro salvo!</div>

        <div class="hr"></div>
        <h3>ğŸ“š HistÃ³rico (Ãºltimos 10 dias)</h3>
        <div id="gutBox" class="list"></div>
      </div>
    </div>

    <!-- METAS SEMANAIS -->
    <div class="card" id="metaSemanal" style="grid-column:span 12">
      <div class="hd">
        <div>
          <h2>ğŸ¯ Metas semanais (painel visual)</h2>
          <small>Marque e veja sua consistÃªncia</small>
        </div>
        <div class="badge">ğŸ”¥ consistÃªncia > perfeiÃ§Ã£o</div>
      </div>
      <div class="bd">
        <div class="item">
          <div class="top"><b>âœ… Checklist da semana</b><span class="badge">reset manual</span></div>
          <div class="meta">Dica: no domingo, clique em â€œZerar semanaâ€ e comeÃ§a de novo.</div>

          <div class="hr"></div>

          <div class="two">
            <div class="item">
              <b>ğŸ‹ï¸ Treinos (meta: 4/4)</b>
              <div class="meta">
                <label><input type="checkbox" id="wSeg"> Segunda</label><br/>
                <label><input type="checkbox" id="wTer"> TerÃ§a</label><br/>
                <label><input type="checkbox" id="wQua"> Quarta</label><br/>
                <label><input type="checkbox" id="wQui"> Quinta</label><br/>
                <label><input type="checkbox" id="wSex"> Sexta</label>
              </div>
            </div>
            <div class="item">
              <b>ğŸ’§ HÃ¡bito (meta: 5/7)</b>
              <div class="meta">
                <label><input type="checkbox" id="wAgua"> Ãgua boa no dia</label><br/>
                <label><input type="checkbox" id="wChia"> Chia em jejum</label><br/>
                <label><input type="checkbox" id="wCardio"> Cardio 12â€“15 min</label><br/>
                <label><input type="checkbox" id="wProteina"> ProteÃ­na no jantar</label><br/>
                <label><input type="checkbox" id="wSono"> Dormi ok</label>
              </div>
            </div>
          </div>

          <div class="btnrow" style="margin-top:12px">
            <button class="btn" onclick="saveWeek()">Salvar semana âœ…</button>
            <button class="btn-ghost btn" onclick="resetWeek()">Zerar semana</button>
          </div>
          <div id="toastWeek" class="toast">Semana salva!</div>
        </div>
      </div>
    </div>

    <!-- CALCULADORA DE PROGRESSÃƒO -->
    <div class="card" id="calc" style="grid-column:span 12">
      <div class="hd">
        <div>
          <h2>ğŸ§® Calculadora de progressÃ£o (prÃ³xima carga)</h2>
          <small>Baseada no seu desempenho</small>
        </div>
        <div class="badge">ğŸ“ˆ sobe peso com seguranÃ§a</div>
      </div>
      <div class="bd">
        <div class="two">
          <div>
            <label><b>ExercÃ­cio</b></label>
            <select id="calcEx"></select>
          </div>
          <div>
            <label><b>Objetivo de reps</b></label>
            <select id="calcTarget">
              <option value="12">12 reps</option>
              <option value="10">10 reps</option>
              <option value="8">8 reps (pesado)</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div class="full">
            <label><b>Ãšltimo treino: como foi?</b></label>
            <select id="calcFeel">
              <option value="facil">ğŸ˜Š FÃ¡cil (sobrou forÃ§a)</option>
              <option value="ok">ğŸ™‚ Ok (difÃ­cil no final, forma boa)</option>
              <option value="pesado">ğŸ˜£ Pesado demais (nÃ£o bateu 8)</option>
            </select>
          </div>
          <div>
            <label><b>Carga atual (kg)</b></label>
            <input id="calcKg" type="number" step="0.5" placeholder="Ex.: 30"/>
          </div>
          <div>
            <label><b>Incremento</b></label>
            <select id="calcInc">
              <option value="1">+1 kg</option>
              <option value="2" selected>+2 kg</option>
              <option value="2.5">+2,5 kg</option>
              <option value="5">+5 kg</option>
            </select>
          </div>
        </div>

        <div class="btnrow" style="margin-top:12px">
          <button class="btn" onclick="calcNext()">Calcular âœ…</button>
        </div>

        <div class="item" style="margin-top:12px">
          <div class="top"><b>ğŸ“Œ SugestÃ£o</b><span class="badge">resultado</span></div>
          <div class="meta" id="calcOut">Preencha e clique em calcular ğŸ™‚</div>
        </div>
      </div>
    </div>

    <!-- FOTOS ANTES/DEPOIS -->
    <div class="card" id="fotos" style="grid-column:span 12">
      <div class="hd">
        <div>
          <h2>ğŸ“¸ Antes & Depois</h2>
          <small>Guarde suas fotos pra ver sua evoluÃ§Ã£o</small>
        </div>
        <div class="badge">ğŸ’¡ use luz parecida</div>
      </div>
      <div class="bd">
        <div class="two">
          <div class="item">
            <div class="top"><b>â• Adicionar foto</b><span class="badge">salva no aparelho</span></div>

            <div class="hr"></div>

            <label><b>Tipo</b></label>
            <select id="pTipo">
              <option value="antes">ğŸ“Œ Antes</option>
              <option value="depois">âœ¨ Depois</option>
            </select>

            <div style="margin-top:10px">
              <label><b>Data</b></label>
              <input id="pData" type="date"/>
            </div>

            <div style="margin-top:10px">
              <label><b>Legenda</b></label>
              <input id="pLegenda" placeholder="Ex.: 2 doses / 56,9kg / cintura 72" />
            </div>

            <div style="margin-top:10px">
              <label><b>Escolher imagem</b></label>
              <input id="pFile" type="file" accept="image/*" />
              <div class="hint">ğŸ“Œ Dica: use fotos leves (nÃ£o muito grandes) pra nÃ£o lotar o armazenamento.</div>
            </div>

            <div class="btnrow" style="margin-top:12px">
              <button class="btn" onclick="savePhoto()">Salvar foto âœ…</button>
              <button class="btn-ghost btn" onclick="exportPhotosOnly()">Backup sÃ³ das fotos</button>
            </div>
            <div id="toastPhoto" class="toast">Foto salva!</div>
          </div>

          <div class="item">
            <div class="top"><b>âœ¨ Dicas pra foto ficar justa</b><span class="badge">resultado real</span></div>
            <div class="meta">
              âœ… Mesma roupa (ou parecida) <br/>
              âœ… Mesma luz/Ã¢ngulo <br/>
              âœ… PosiÃ§Ã£o: frente + lado <br/>
              âœ… Tire 2 fotos por mÃªs (jÃ¡ dÃ¡ um choque de realidade bom).
            </div>
          </div>
        </div>

        <div class="hr"></div>
        <h3>ğŸ–¼ï¸ Sua galeria</h3>
        <div id="photosBox" class="photoGrid"></div>
      </div>
    </div>

    <!-- BACKUP -->
    <div class="card" id="backup" style="grid-column:span 12">
      <div class="hd">
        <div>
          <h2>ğŸ›¡ï¸ Backup (pra nÃ£o perder nada)</h2>
          <small>Cargas + medidas + intestino + metas + fotos</small>
        </div>
        <div class="badge">âœ… recomendado 1x por mÃªs</div>
      </div>
      <div class="bd">
        <div class="btnrow">
          <button class="btn" onclick="exportAll()">â¬‡ï¸ Exportar backup completo</button>
          <label class="btn-ghost btn" style="cursor:pointer">
            â¬†ï¸ Importar backup
            <input id="importFile" type="file" accept="application/json" style="display:none" onchange="importAll(event)" />
          </label>
          <button class="btn-warn" onclick="resetAll()">âš ï¸ Zerar tudo</button>
        </div>
        <p class="hint">Backup vira um arquivo .json. Guarde no Drive/WhatsApp com vocÃª mesma.</p>
      </div>
    </div>

  </div>
</div>

<script>
  // ==========
  // DADOS TREINO (com suas cargas sugeridas + links PT)
  // ==========
  const EX = {
    seg: [
      {n:"1ï¸âƒ£ Cadeira Flexora", s:"3Ã—12", w:"ğŸ‘‰ 20â€“25kg", t:"Controle total. Sem tirar o quadril do banco.", v:"https://www.youtube.com/results?search_query=cadeira+flexora+como+fazer+correto"},
      {n:"2ï¸âƒ£ Stiff com halter", s:"3Ã—12", w:"ğŸ‘‰ 6â€“8kg cada lado", t:"Coluna neutra. Desce devagar. Sente alongar posterior.", v:"https://www.youtube.com/results?search_query=stiff+com+halter+como+fazer"},
      {n:"3ï¸âƒ£ ElevaÃ§Ã£o pÃ©lvica (Hip Thrust)", s:"4Ã—10", w:"ğŸ‘‰ 20kg (meta evoluir)", t:"Pausa 1s no topo. NÃ£o arquear lombar.", v:"https://www.youtube.com/results?search_query=eleva%C3%A7%C3%A3o+p%C3%A9lvica+como+fazer"},
      {n:"4ï¸âƒ£ Abdutora mÃ¡quina", s:"3Ã—15", w:"ğŸ‘‰ 30â€“35kg", t:"Inclina levemente pra frente e segura 1s aberta.", v:"https://www.youtube.com/results?search_query=abdutora+m%C3%A1quina+como+usar"},
      {n:"ğŸš¶â€â™€ï¸ Cardio (opcional)", s:"12 min", w:"ğŸ‘‰ esteira inclinada", t:"Leve/moderado pra ajudar barriga sem perder glÃºteo.", v:"https://www.youtube.com/results?search_query=esteira+inclinada+como+fazer"}
    ],
    ter: [
      {n:"1ï¸âƒ£ Supino inclinado mÃ¡quina", s:"3Ã—12", w:"ğŸ‘‰ 15â€“20kg", t:"Peito aberto. Ombros pra baixo.", v:"https://www.youtube.com/results?search_query=supino+inclinado+m%C3%A1quina+como+fazer"},
      {n:"2ï¸âƒ£ Crucifixo mÃ¡quina", s:"3Ã—12", w:"ğŸ‘‰ 15kg", t:"Controlado. NÃ£o esticar demais.", v:"https://www.youtube.com/results?search_query=crucifixo+m%C3%A1quina+como+fazer"},
      {n:"3ï¸âƒ£ ElevaÃ§Ã£o lateral halter", s:"3Ã—12", w:"ğŸ‘‰ 4kg", t:"Sobe atÃ© linha do ombro. Sem balanÃ§ar.", v:"https://www.youtube.com/results?search_query=eleva%C3%A7%C3%A3o+lateral+halter+como+fazer"},
      {n:"4ï¸âƒ£ Desenvolvimento ombro halter", s:"3Ã—10", w:"ğŸ‘‰ 6kg", t:"Controle. NÃ£o jogar a lombar.", v:"https://www.youtube.com/results?search_query=desenvolvimento+ombro+halter+como+fazer"},
      {n:"â³ VÃ¡cuo abdominal", s:"3Ã—20s", w:"ğŸ‘‰ cintura marcada", t:"Solta o ar e puxa o umbigo pra dentro.", v:"https://www.youtube.com/results?search_query=vacuum+abdominal+como+fazer"}
    ],
    qua: [
      {n:"1ï¸âƒ£ Leg Press", s:"4Ã—12", w:"ğŸ‘‰ 80kg (meta 100â€“110kg)", t:"PÃ© um pouco mais alto. NÃ£o travar joelho.", v:"https://www.youtube.com/results?search_query=leg+press+como+fazer+correto"},
      {n:"2ï¸âƒ£ Agachamento no Smith", s:"3Ã—10", w:"ğŸ‘‰ 10kg cada lado", t:"PÃ©s levemente Ã  frente. Desce controlado.", v:"https://www.youtube.com/results?search_query=agachamento+no+smith+como+fazer"},
      {n:"3ï¸âƒ£ Cadeira Extensora", s:"3Ã—12", w:"ğŸ‘‰ 25kg", t:"Sobe forte e desce controlando.", v:"https://www.youtube.com/results?search_query=cadeira+extensora+como+fazer"},
      {n:"4ï¸âƒ£ Abdutora", s:"3Ã—15", w:"ğŸ‘‰ 30â€“35kg", t:"Foco no glÃºteo lateral (ajuda ampulheta).", v:"https://www.youtube.com/results?search_query=abdutora+m%C3%A1quina+como+usar"}
    ],
    qui: [
      {n:"1ï¸âƒ£ Puxada frente", s:"3Ã—12", w:"ğŸ‘‰ 25kg", t:"Puxa com cotovelos. Ombros pra baixo.", v:"https://www.youtube.com/results?search_query=puxada+frente+na+polia+como+fazer"},
      {n:"2ï¸âƒ£ Remada baixa", s:"3Ã—12", w:"ğŸ‘‰ 25kg", t:"Segura 1s atrÃ¡s. Postura firme.", v:"https://www.youtube.com/results?search_query=remada+baixa+na+polia+como+fazer"},
      {n:"3ï¸âƒ£ Face Pull", s:"3Ã—15", w:"ğŸ‘‰ leve/mÃ©dio", t:"Postura e colo bonito. Cotovelos altos.", v:"https://www.youtube.com/results?search_query=face+pull+como+fazer"},
      {n:"4ï¸âƒ£ Prancha", s:"3Ã—40s", w:"ğŸ‘‰ core firme", t:"Barriga pra dentro. Sem cair lombar.", v:"https://www.youtube.com/results?search_query=prancha+abdominal+como+fazer"}
    ],
    sex: [
      {n:"1ï¸âƒ£ ElevaÃ§Ã£o pÃ©lvica (pesado)", s:"4Ã—8", w:"ğŸ‘‰ 30kg (meta 45kg)", t:"Forma perfeita. Pausa no topo.", v:"https://www.youtube.com/results?search_query=hip+thrust+como+fazer"},
      {n:"2ï¸âƒ£ Stiff", s:"3Ã—12", w:"ğŸ‘‰ 8kg cada lado", t:"Controle, coluna neutra.", v:"https://www.youtube.com/results?search_query=stiff+com+halter+como+fazer"},
      {n:"3ï¸âƒ£ Afundo andando", s:"3Ã—10 cada perna", w:"ğŸ‘‰ 4â€“6kg", t:"Tronco levemente Ã  frente, calcanhar empurra.", v:"https://www.youtube.com/results?search_query=afundo+andando+como+fazer"},
      {n:"4ï¸âƒ£ Abdutora", s:"4Ã—15", w:"ğŸ‘‰ 35â€“40kg", t:"Segura 1s aberta. GlÃºteo lateral.", v:"https://www.youtube.com/results?search_query=abdutora+m%C3%A1quina+como+usar"},
      {n:"â³ VÃ¡cuo abdominal", s:"3Ã—20s", w:"ğŸ‘‰ cintura", t:"ConsistÃªncia 3x/semana.", v:"https://www.youtube.com/results?search_query=vacuum+abdominal+como+fazer"}
    ],
  };

  // ==========
  // STORAGE KEYS
  // ==========
  const LS = {
    sets:"amp_v3_sets",
    measures:"amp_v3_measures",
    gut:"amp_v3_gut",
    week:"amp_v3_week",
    photos:"amp_v3_photos"
  };

  const $ = (id)=>document.getElementById(id);
  const load = (k, fb)=>{ try{ const r=localStorage.getItem(k); return r?JSON.parse(r):fb }catch(e){ return fb } };
  const save = (k, v)=>localStorage.setItem(k, JSON.stringify(v));

  function todayISO(){
    const d = new Date();
    const tz = new Date(d.getTime() - d.getTimezoneOffset()*60000);
    return tz.toISOString().slice(0,10);
  }
  function toast(id){
    const t=$(id); if(!t) return;
    t.style.display="block";
    setTimeout(()=>t.style.display="none", 1300);
  }
  function setStatus(msg){
    $("statusPill").textContent = msg;
    setTimeout(()=> $("statusPill").textContent="âœ¨ Hoje Ã© dia de evoluir com calma e constÃ¢ncia, MiriÃ£ ğŸ’›", 4500);
  }
  function go(id){ $(id).scrollIntoView({behavior:"smooth", block:"start"}); }

  // ==========
  // RENDER TREINOS
  // ==========
  function renderList(day, el){
    const box=$(el); box.innerHTML="";
    EX[day].forEach(e=>{
      const div=document.createElement("div");
      div.className="item";
      div.innerHTML=`
        <div class="top">
          <b>${e.n}</b>
          <span class="badge">${e.s}</span>
        </div>
        <div class="meta">${e.w}<br/>${e.t}<br/>ğŸ”— <a target="_blank" rel="noreferrer" href="${e.v}">ver vÃ­deo (PT)</a></div>
      `;
      box.appendChild(div);
    });
  }

  function setupTabs(){
    const tabs = document.querySelectorAll(".tab");
    tabs.forEach(t=>{
      t.addEventListener("click", ()=>{
        tabs.forEach(x=>x.classList.remove("active"));
        t.classList.add("active");
        const key=t.dataset.tab;
        ["seg","ter","qua","qui","sex","pro"].forEach(k=>{
          const page = $("tab-"+k);
          if(page) page.style.display = (k===key) ? "block" : "none";
        });
      });
    });
  }

  // ==========
  // EXERCISES SELECTS
  // ==========
  function allExerciseNames(){
    const names=[];
    Object.values(EX).forEach(list=>list.forEach(x=>names.push(x.n.replace(/^(\dï¸âƒ£\s)/,'')))); // sem emoji do nÃºmero
    // remove "Cardio" e "VÃ¡cuo" se quiser manter sÃ³ cargas de forÃ§a:
    return [...new Set(names)].filter(n=>!n.toLowerCase().includes("cardio") && !n.toLowerCase().includes("vÃ¡cuo"));
  }

  function fillSelects(){
    const names=allExerciseNames();

    $("exSelect").innerHTML="";
    $("chartSelect").innerHTML="";
    $("calcEx").innerHTML="";

    names.forEach(n=>{
      const o1=document.createElement("option"); o1.value=n; o1.textContent=n;
      const o2=document.createElement("option"); o2.value=n; o2.textContent=n;
      const o3=document.createElement("option"); o3.value=n; o3.textContent=n;
      $("exSelect").appendChild(o1);
      $("chartSelect").appendChild(o2);
      $("calcEx").appendChild(o3);
    });

    $("exSelect").addEventListener("change", renderHistory);
    $("chartSelect").addEventListener("change", renderExerciseChart);
  }

  // ==========
  // CARGAS
  // ==========
  function clearForm(){
    $("exDate").value=todayISO();
    $("exKg").value="";
    $("exReps").value="";
    $("exObs").value="";
  }

  function saveSet(){
    const name=$("exSelect").value;
    const date=$("exDate").value || todayISO();
    const kg=Number($("exKg").value||0);
    const reps=Number($("exReps").value||0);
    const obs=$("exObs").value.trim();

    if(!name || !kg || !reps){
      alert("Preencha exercÃ­cio, carga e reps ğŸ™‚");
      return;
    }

    const data=load(LS.sets,[]);
    data.push({name,date,kg,reps,obs, createdAt:Date.now()});
    data.sort((a,b)=>a.date>b.date?1:-1);
    save(LS.sets,data);

    clearForm();
    renderHistory();
    renderExerciseChart();
    toast("toastSet");
    setStatus("âœ… Registro salvo! VocÃª tÃ¡ fazendo do jeito certo ğŸ’›");
  }

  function renderHistory(){
    const name=$("exSelect").value;
    const box=$("historyBox");
    const data=load(LS.sets,[]).filter(x=>x.name===name).slice().reverse();

    if(!data.length){
      box.innerHTML=`<div class="item">Sem registros ainda para <b>${name}</b>. Registra hoje e comeÃ§a a evoluÃ§Ã£o ğŸ“ˆ</div>`;
      return;
    }

    box.innerHTML="";
    data.slice(0,12).forEach(x=>{
      const div=document.createElement("div");
      div.className="item";
      div.innerHTML=`
        <div class="top"><b>${x.date} â€¢ ${x.kg} kg Ã— ${x.reps}</b><span class="badge">${x.obs?"ğŸ“":"ğŸ“Œ"}</span></div>
        <div class="meta">${x.obs?x.obs:"â€”"}</div>
      `;
      box.appendChild(div);
    });
  }

  // ==========
  // MEDIDAS
  // ==========
  function saveMeasures(){
    const date=$("mDate").value || todayISO();
    const peso=Number($("mPeso").value||0);
    const cintura=Number($("mCintura").value||0);
    const abdomen=Number($("mAbdomen").value||0);
    const gluteo=Number($("mGluteo").value||0);

    if(!peso || !cintura || !abdomen || !gluteo){
      alert("Preencha peso + cintura + abdÃ´men + glÃºteo ğŸ™‚");
      return;
    }

    const data=load(LS.measures,[]);
    data.push({date,peso,cintura,abdomen,gluteo, createdAt:Date.now()});
    data.sort((a,b)=>a.date>b.date?1:-1);
    save(LS.measures,data);

    renderMeasures();
    renderMeasuresChart();
    toast("toastMeasures");
    setStatus("âœ… Medidas salvas! Seu painel atualizou ğŸ’–");
  }

  function renderMeasures(){
    const box=$("measuresBox");
    const data=load(LS.measures,[]).slice().reverse();

    if(!data.length){
      box.innerHTML=`<div class="item">Ainda sem check-in. Coloque suas medidas atuais e salve âœ…</div>`;
      $("kpiPeso").textContent="56,9 kg";
      $("kpiCintura").textContent="72 cm";
      $("kpiAbdomen").textContent="81 cm";
      $("kpiGluteo").textContent="96 cm";
      return;
    }

    box.innerHTML="";
    data.slice(0,8).forEach(x=>{
      const div=document.createElement("div");
      div.className="item";
      div.innerHTML=`
        <div class="top"><b>${x.date}</b><span class="badge">${x.peso} kg</span></div>
        <div class="meta">Cintura: <b>${x.cintura}</b> â€¢ AbdÃ´men: <b>${x.abdomen}</b> â€¢ GlÃºteo: <b>${x.gluteo}</b></div>
      `;
      box.appendChild(div);
    });

    const last=data[0];
    $("kpiPeso").textContent=`${last.peso} kg`;
    $("kpiCintura").textContent=`${last.cintura} cm`;
    $("kpiAbdomen").textContent=`${last.abdomen} cm`;
    $("kpiGluteo").textContent=`${last.gluteo} cm`;
  }

  // ==========
  // INTESTINO
  // ==========
  function saveGut(){
    const date=$("gDate").value || todayISO();
    const chia=$("gChia").value;
    const evac=$("gEvac").value;
    const inch=$("gInchaco").value;
    const obs=$("gObs").value.trim();

    const data=load(LS.gut,[]);
    // substitui se jÃ¡ existir mesmo dia
    const i=data.findIndex(x=>x.date===date);
    const rec={date,chia,evac,inch,obs, createdAt:Date.now()};
    if(i>=0) data[i]=rec; else data.push(rec);
    data.sort((a,b)=>a.date>b.date?1:-1);
    save(LS.gut,data);

    renderGut();
    toast("toastGut");
    setStatus("ğŸš½ Registro salvo! VocÃª estÃ¡ se cuidando de verdade ğŸ’›");
  }

  function renderGut(){
    const box=$("gutBox");
    const data=load(LS.gut,[]).slice().reverse();
    if(!data.length){
      box.innerHTML=`<div class="item">Ainda sem registros. Salve hoje e acompanhe 7 dias âœ…</div>`;
      return;
    }
    const mapEv = {nao:"âŒ NÃ£o", pouco:"âœ… Pouquinho", normal:"âœ… Normal", muito:"âœ… Muito"};
    const mapCh = {sim:"âœ… Sim", nao:"âŒ NÃ£o"};
    const mapIn = {desinchada:"ğŸ’– Desinchada", normal:"ğŸ™‚ Normal", inchada:"ğŸ˜£ Inchada"};

    box.innerHTML="";
    data.slice(0,10).forEach(x=>{
      const div=document.createElement("div");
      div.className="item";
      div.innerHTML=`
        <div class="top"><b>${x.date}</b><span class="badge">${mapCh[x.chia]}</span></div>
        <div class="meta">EvacuaÃ§Ã£o: <b>${mapEv[x.evac]}</b> â€¢ InchaÃ§o: <b>${mapIn[x.inch]}</b>${x.obs?`<br/>ğŸ“ ${x.obs}`:""}</div>
      `;
      box.appendChild(div);
    });
  }

  // ==========
  // METAS SEMANAIS
  // ==========
  function saveWeek(){
    const w={
      wSeg:$("wSeg").checked, wTer:$("wTer").checked, wQua:$("wQua").checked, wQui:$("wQui").checked, wSex:$("wSex").checked,
      wAgua:$("wAgua").checked, wChia:$("wChia").checked, wCardio:$("wCardio").checked, wProteina:$("wProteina").checked, wSono:$("wSono").checked,
      savedAt:Date.now()
    };
    save(LS.week,w);
    toast("toastWeek");
    setStatus("ğŸ¯ Semana salva! ConsistÃªncia Ã© seu superpoder ğŸ’–");
  }
  function loadWeek(){
    const w=load(LS.week,null);
    if(!w) return;
    Object.keys(w).forEach(k=>{
      if($(k) && typeof w[k]==="boolean") $(k).checked = w[k];
    });
  }
  function resetWeek(){
    if(!confirm("Zerar o checklist da semana?")) return;
    ["wSeg","wTer","wQua","wQui","wSex","wAgua","wChia","wCardio","wProteina","wSono"].forEach(id=>{ if($(id)) $(id).checked=false; });
    saveWeek();
  }

  // ==========
  // CALCULADORA PROGRESSÃƒO
  // ==========
  function calcNext(){
    const feel=$("calcFeel").value;
    const kg=Number($("calcKg").value||0);
    const inc=Number($("calcInc").value||2);
    const target=$("calcTarget").value;

    if(!kg){ $("calcOut").innerHTML="Coloque sua carga atual ğŸ™‚"; return; }

    let suggestion=kg;
    let msg="";

    if(feel==="facil"){
      suggestion = kg + inc;
      msg = `ğŸ˜Š VocÃª disse que foi <b>fÃ¡cil</b>. SugestÃ£o: subir para <b>${suggestion} kg</b> e tentar <b>${target} reps</b>.`;
    } else if(feel==="ok"){
      suggestion = kg;
      msg = `ğŸ™‚ VocÃª disse que foi <b>ok</b>. SugestÃ£o: manter <b>${suggestion} kg</b> e melhorar a forma/controle antes de subir.`;
    } else {
      suggestion = Math.max(kg - inc, 0);
      msg = `ğŸ˜£ VocÃª disse que estava <b>pesado demais</b>. SugestÃ£o: descer para <b>${suggestion} kg</b> e bater <b>8â€“10 reps</b> com forma boa.`;
    }

    $("calcOut").innerHTML = `ğŸ“Œ <b>PrÃ³xima carga:</b> ${suggestion} kg<br/>${msg}<br/><span style="color:#6b6b6b">Regra: tÃ©cnica perfeita primeiro. ProgressÃ£o constante depois.</span>`;
  }

  // ==========
  // GRÃFICOS
  // ==========
  let chartEx=null, chartMe=null;

  function renderExerciseChart(){
    const name=$("chartSelect").value;
    const data=load(LS.sets,[]).filter(x=>x.name===name).slice();

    const labels=data.map(x=>x.date);
    const kg=data.map(x=>x.kg);
    const reps=data.map(x=>x.reps);

    const ctx=$("chartExercise").getContext("2d");
    if(chartEx) chartEx.destroy();

    chartEx=new Chart(ctx,{
      type:"line",
      data:{
        labels,
        datasets:[
          {label:"Carga (kg)", data:kg, tension:.35},
          {label:"Reps", data:reps, tension:.35}
        ]
      },
      options:{
        responsive:true,
        plugins:{legend:{position:"bottom"}},
        scales:{y:{beginAtZero:true}}
      }
    });
  }

  function renderMeasuresChart(){
    const data=load(LS.measures,[]).slice();
    const labels=data.map(x=>x.date);
    const cintura=data.map(x=>x.cintura);
    const gluteo=data.map(x=>x.gluteo);

    const ctx=$("chartMeasures").getContext("2d");
    if(chartMe) chartMe.destroy();

    chartMe=new Chart(ctx,{
      type:"line",
      data:{
        labels,
        datasets:[
          {label:"Cintura (cm)", data:cintura, tension:.35},
          {label:"GlÃºteo (cm)", data:gluteo, tension:.35},
        ]
      },
      options:{
        responsive:true,
        plugins:{legend:{position:"bottom"}},
        scales:{y:{beginAtZero:false}}
      }
    });
  }

  // ==========
  // FOTOS ANTES/DEPOIS
  // ==========
  function compressImage(file, maxW=900, quality=0.82){
    return new Promise((resolve,reject)=>{
      const img=new Image();
      const reader=new FileReader();
      reader.onload=(e)=>{
        img.onload=()=>{
          const scale=Math.min(1, maxW/img.width);
          const w=Math.round(img.width*scale);
          const h=Math.round(img.height*scale);
          const c=document.createElement("canvas");
          c.width=w; c.height=h;
          const ctx=c.getContext("2d");
          ctx.drawImage(img,0,0,w,h);
          const dataUrl=c.toDataURL("image/jpeg", quality);
          resolve(dataUrl);
        };
        img.onerror=reject;
        img.src=e.target.result;
      };
      reader.onerror=reject;
      reader.readAsDataURL(file);
    });
  }

  async function savePhoto(){
    const tipo=$("pTipo").value;
    const date=$("pData").value || todayISO();
    const legenda=$("pLegenda").value.trim();
    const file=$("pFile").files?.[0];

    if(!file){
      alert("Escolha uma imagem ğŸ™‚");
      return;
    }

    const dataUrl = await compressImage(file, 900, 0.82);
    const photos=load(LS.photos,[]);
    photos.unshift({tipo,date,legenda,dataUrl, createdAt:Date.now()});
    save(LS.photos, photos.slice(0,40)); // limite pra nÃ£o lotar

    $("pFile").value="";
    toast("toastPhoto");
    renderPhotos();
    setStatus("ğŸ“¸ Foto salva! Sua evoluÃ§Ã£o tÃ¡ registrada ğŸ’–");
  }

  function renderPhotos(){
    const box=$("photosBox");
    const photos=load(LS.photos,[]);
    if(!photos.length){
      box.innerHTML = `<div class="item" style="grid-column:1/-1">Ainda sem fotos. Adicione uma â€œAntesâ€ e uma â€œDepoisâ€ ğŸ“¸</div>`;
      return;
    }
    box.innerHTML="";
    photos.forEach((p, idx)=>{
      const div=document.createElement("div");
      div.className="photoCard";
      div.innerHTML=`
        <img src="${p.dataUrl}" alt="foto ${p.tipo}">
        <div class="cap">
          <b>${p.tipo==="antes"?"ğŸ“Œ Antes":"âœ¨ Depois"} â€¢ ${p.date}</b>
          <span>${p.legenda ? p.legenda : "â€”"}</span>
          <div class="mini">
            <button class="btn-ghost btn" onclick="removePhoto(${idx})">ğŸ—‘ï¸ Apagar</button>
          </div>
        </div>
      `;
      box.appendChild(div);
    });
  }

  function removePhoto(idx){
    if(!confirm("Apagar essa foto?")) return;
    const photos=load(LS.photos,[]);
    photos.splice(idx,1);
    save(LS.photos,photos);
    renderPhotos();
  }

  function exportPhotosOnly(){
    const payload={exportedAt:new Date().toISOString(), photos:load(LS.photos,[])};
    const blob=new Blob([JSON.stringify(payload,null,2)],{type:"application/json"});
    const a=document.createElement("a");
    a.href=URL.createObjectURL(blob);
    a.download="backup-fotos-ampulheta.json";
    a.click();
    setStatus("â¬‡ï¸ Backup das fotos baixado ğŸ’›");
  }

  // ==========
  // BACKUP COMPLETO
  // ==========
  function exportAll(){
    const payload={
      exportedAt:new Date().toISOString(),
      sets:load(LS.sets,[]),
      measures:load(LS.measures,[]),
      gut:load(LS.gut,[]),
      week:load(LS.week,null),
      photos:load(LS.photos,[])
    };
    const blob=new Blob([JSON.stringify(payload,null,2)],{type:"application/json"});
    const a=document.createElement("a");
    a.href=URL.createObjectURL(blob);
    a.download="backup-projeto-ampulheta-completo.json";
    a.click();
    setStatus("ğŸ›¡ï¸ Backup completo baixado! Guarda com vocÃª ğŸ’›");
  }

  function importAll(event){
    const file=event.target.files?.[0];
    if(!file) return;
    const reader=new FileReader();
    reader.onload=()=>{
      try{
        const p=JSON.parse(reader.result);
        if(p.sets) save(LS.sets,p.sets);
        if(p.measures) save(LS.measures,p.measures);
        if(p.gut) save(LS.gut,p.gut);
        if(p.week) save(LS.week,p.week);
        if(p.photos) save(LS.photos,p.photos);
        init();
        setStatus("â¬†ï¸ Backup importado! TÃ¡ tudo aqui de novo ğŸ’–");
      }catch(e){
        alert("Arquivo invÃ¡lido ğŸ˜•");
      }
    };
    reader.readAsText(file);
  }

  function resetAll(){
    if(!confirm("Tem certeza que quer apagar TUDO?")) return;
    Object.values(LS).forEach(k=>localStorage.removeItem(k));
    init();
    setStatus("âš ï¸ Tudo zerado. Quando quiser, recomeÃ§a ğŸ’›");
  }

  // ==========
  // INIT
  // ==========
  function init(){
    // default dates
    $("exDate").value=todayISO();
    $("mDate").value=todayISO();
    $("gDate").value=todayISO();
    $("pData").value=todayISO();

    // render treino lists
    renderList("seg","list-seg");
    renderList("ter","list-ter");
    renderList("qua","list-qua");
    renderList("qui","list-qui");
    renderList("sex","list-sex");

    setupTabs();
    fillSelects();
    clearForm();

    renderMeasures();
    renderGut();
    loadWeek();
    renderPhotos();

    renderMeasuresChart();
    renderExerciseChart();
  }

  init();
</script>
</body>
</html>
