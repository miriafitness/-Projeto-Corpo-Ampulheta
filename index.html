<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üçë Projeto Ampulheta da Miri√£</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#ff2d7d">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Fonte -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

  <!-- Chart.js (gr√°fico real) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <style>
    :root{
      --bg1:#0b0b12;
      --bg2:#141428;
      --glass:rgba(255,255,255,.08);
      --glass2:rgba(255,255,255,.12);
      --stroke:rgba(255,255,255,.16);
      --txt:#f7f7fb;
      --muted:rgba(255,255,255,.72);
      --muted2:rgba(255,255,255,.55);
      --pink:#ff2d7d;
      --pink2:#ff5aa5;
      --lime:#35ff9a;
      --warn:#ffd166;
      --danger:#ff5c7a;
      --shadow: 0 18px 50px rgba(0,0,0,.45);
      --radius: 18px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--txt);
      background:
        radial-gradient(1200px 700px at 20% -10%, rgba(255,45,125,.35), transparent 60%),
        radial-gradient(1000px 700px at 110% 10%, rgba(53,255,154,.18), transparent 55%),
        radial-gradient(900px 600px at 50% 110%, rgba(255,209,102,.18), transparent 55%),
        linear-gradient(160deg, var(--bg1), var(--bg2));
      min-height:100vh;
      padding-bottom:92px; /* espa√ßo do menu inferior */
    }

    .wrap{
      max-width:980px;
      margin:0 auto;
      padding:18px 14px 18px;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin:8px 0 14px;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:10px;
    }

    .logo{
      width:44px;height:44px;border-radius:14px;
      background: linear-gradient(135deg, var(--pink), var(--pink2));
      box-shadow: 0 12px 30px rgba(255,45,125,.25);
      display:grid;place-items:center;
      border:1px solid rgba(255,255,255,.18);
    }
    .logo span{font-size:22px}

    .title{
      line-height:1.05;
    }
    .title h1{
      margin:0;
      font-size:18px;
      letter-spacing:.2px;
      font-weight:800;
    }
    .title p{
      margin:3px 0 0;
      color:var(--muted2);
      font-size:12px;
    }

    .pill{
      padding:10px 12px;
      border-radius:999px;
      background: rgba(255,255,255,.08);
      border:1px solid var(--stroke);
      display:flex;
      align-items:center;
      gap:8px;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
      user-select:none;
      cursor:pointer;
      transition: transform .12s ease;
    }
    .pill:active{transform: scale(.98)}
    .pill b{font-size:12px}
    .pill small{color:var(--muted2);font-size:11px}

    .grid{
      display:grid;
      grid-template-columns: 1.25fr .75fr;
      gap:14px;
    }
    @media (max-width: 940px){
      .grid{grid-template-columns: 1fr; }
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      border:1px solid var(--stroke);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card .hd{
      padding:14px 14px 10px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
    }
    .card .hd h2{
      margin:0;
      font-size:14px;
      letter-spacing:.2px;
      font-weight:800;
    }
    .card .hd p{
      margin:4px 0 0;
      font-size:12px;
      color: var(--muted2);
    }
    .card .bd{padding:0 14px 14px}
    .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }

    .btn{
      background: linear-gradient(135deg, var(--pink), var(--pink2));
      color:white;
      border:none;
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
      font-weight:800;
      letter-spacing:.2px;
      box-shadow: 0 14px 30px rgba(255,45,125,.25);
      transition: transform .12s ease, filter .12s ease;
      user-select:none;
    }
    .btn:active{transform: scale(.98)}
    .btn.secondary{
      background: rgba(255,255,255,.08);
      border:1px solid var(--stroke);
      box-shadow:none;
      font-weight:700;
    }
    .btn.ghost{
      background: transparent;
      border:1px dashed rgba(255,255,255,.22);
      box-shadow:none;
      font-weight:700;
      color:var(--txt);
    }

    .chips{
      display:flex; flex-wrap:wrap; gap:8px;
      margin-top:8px;
    }
    .chip{
      font-size:11px;
      color:var(--muted);
      background: rgba(255,255,255,.07);
      border:1px solid rgba(255,255,255,.12);
      padding:6px 10px;
      border-radius:999px;
    }

    .field{
      display:grid;
      gap:6px;
      margin-top:10px;
    }
    .field label{
      font-size:12px;
      color:var(--muted);
      font-weight:700;
    }
    .field input, .field select, .field textarea{
      width:100%;
      padding:12px 12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.20);
      color:var(--txt);
      outline:none;
    }
    .field input::placeholder, .field textarea::placeholder{color:rgba(255,255,255,.35)}
    .field textarea{min-height:70px; resize: vertical;}

    .divider{
      height:1px;
      background: rgba(255,255,255,.10);
      margin:12px 0;
    }

    .kpis{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:10px;
      margin-top:10px;
    }
    @media (max-width: 520px){
      .kpis{grid-template-columns: 1fr; }
    }
    .kpi{
      padding:12px;
      border-radius:14px;
      background: rgba(255,255,255,.07);
      border:1px solid rgba(255,255,255,.12);
    }
    .kpi small{display:block;color:var(--muted2);font-size:11px;margin-bottom:6px}
    .kpi b{font-size:16px}
    .kpi .tag{font-size:11px;color:var(--muted);margin-top:6px}

    /* progress */
    .progress{
      width:100%;
      height:14px;
      border-radius:999px;
      background: rgba(255,255,255,.10);
      overflow:hidden;
      border:1px solid rgba(255,255,255,.12);
    }
    .bar{
      height:100%;
      width:0%;
      border-radius:999px;
      background: linear-gradient(90deg, var(--pink), var(--pink2));
      transition: width .25s ease;
    }

    /* treino */
    .tabs{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      padding:0 14px 14px;
    }
    .tab{
      padding:10px 12px;
      border-radius:14px;
      background: rgba(255,255,255,.07);
      border:1px solid rgba(255,255,255,.14);
      cursor:pointer;
      font-weight:800;
      font-size:12px;
      user-select:none;
      transition: transform .12s ease, background .12s ease;
    }
    .tab.active{
      background: linear-gradient(135deg, rgba(255,45,125,.35), rgba(255,90,165,.20));
      border-color: rgba(255,45,125,.45);
    }
    .tab:active{transform:scale(.98)}

    .ex{
      display:grid;
      gap:10px;
      margin-top:10px;
    }
    .exItem{
      padding:12px;
      border-radius:14px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      display:grid;
      gap:8px;
    }
    .exTop{
      display:flex; gap:10px; justify-content:space-between; align-items:flex-start;
    }
    .exTop b{font-size:13px}
    .exTop small{color:var(--muted2);font-weight:700}
    .exTips{
      color:var(--muted);
      font-size:12px;
      line-height:1.35;
    }
    .exActions{
      display:flex; gap:8px; flex-wrap:wrap; align-items:center;
    }
    .link{
      color:#fff;
      text-decoration:none;
      font-weight:800;
      font-size:12px;
      padding:8px 10px;
      border-radius:12px;
      background: rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.14);
      display:inline-flex;
      gap:8px;
      align-items:center;
    }
    .link:active{transform:scale(.98)}
    .mini{
      font-size:11px;color:var(--muted2);
    }

    /* menu inferior */
    .bottomNav{
      position:fixed;
      left:0; right:0; bottom:0;
      padding:10px 12px 14px;
      backdrop-filter: blur(14px);
      background: linear-gradient(180deg, rgba(10,10,18,.22), rgba(10,10,18,.72));
      border-top:1px solid rgba(255,255,255,.10);
      z-index:99;
    }
    .navRow{
      max-width:980px;
      margin:0 auto;
      display:grid;
      grid-template-columns: repeat(5, 1fr);
      gap:10px;
    }
    .navBtn{
      background: rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.14);
      color:var(--txt);
      border-radius:16px;
      padding:10px 8px;
      display:grid;
      place-items:center;
      gap:4px;
      cursor:pointer;
      user-select:none;
      transition: transform .12s ease, background .12s ease;
      font-weight:800;
      font-size:11px;
    }
    .navBtn.active{
      background: linear-gradient(135deg, rgba(255,45,125,.35), rgba(255,90,165,.20));
      border-color: rgba(255,45,125,.45);
      box-shadow: 0 14px 30px rgba(255,45,125,.14);
    }
    .navBtn:active{transform: scale(.98)}
    .navBtn span{font-size:18px}

    /* se√ß√µes */
    .section{display:none}
    .section.active{display:block}

    .hint{
      margin-top:10px;
      padding:10px 12px;
      border-radius:14px;
      background: rgba(53,255,154,.10);
      border:1px solid rgba(53,255,154,.20);
      color: rgba(255,255,255,.88);
      font-size:12px;
      line-height:1.35;
    }
    .warnBox{
      margin-top:10px;
      padding:10px 12px;
      border-radius:14px;
      background: rgba(255,209,102,.10);
      border:1px solid rgba(255,209,102,.22);
      color: rgba(255,255,255,.90);
      font-size:12px;
      line-height:1.35;
    }

    .listSmall{
      margin-top:10px;
      font-size:12px;
      color:var(--muted);
      line-height:1.35;
    }

    /* modal simples */
    .modalBack{
      position:fixed; inset:0;
      background: rgba(0,0,0,.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding:18px;
      z-index:120;
    }
    .modalBack.show{display:flex}
    .modal{
      width:min(720px, 100%);
      background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
      border:1px solid rgba(255,255,255,.18);
      border-radius:20px;
      box-shadow: 0 22px 70px rgba(0,0,0,.55);
      overflow:hidden;
    }
    .modal .mhd{
      padding:14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .modal .mhd b{font-size:14px}
    .modal .mbd{padding:0 14px 14px}
    .xbtn{
      width:38px; height:38px; border-radius:14px;
      background: rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.14);
      color:var(--txt);
      cursor:pointer;
      font-weight:900;
    }
  </style>
</head>

<body>
  <div class="wrap">

    <!-- TOPBAR -->
    <div class="topbar">
      <div class="brand">
        <div class="logo"><span>üçë</span></div>
        <div class="title">
          <h1>Projeto Ampulheta da Miri√£</h1>
          <p>Treino + cargas + cintura + √°gua + intestino + fotos ‚Ä¢ salva no seu celular</p>
        </div>
      </div>

      <div class="pill" onclick="openModal('ajudaModal')">
        <div>‚ú®</div>
        <div>
          <b>Dicas r√°pidas</b><br>
          <small>instalar no celular</small>
        </div>
      </div>
    </div>

    <div class="grid">
      <!-- COLUNA PRINCIPAL -->
      <div class="col">

        <!-- SE√á√ÉO: DASH -->
        <div id="sec-dash" class="section active">

          <div class="card">
            <div class="hd">
              <div>
                <h2>üìä Painel ULTRA PRO</h2>
                <p>Seu resumo do dia + sua propor√ß√£o ampulheta üòè</p>
              </div>
              <button class="btn secondary" onclick="backupExport()">‚¨áÔ∏è Backup</button>
            </div>

            <div class="bd">
              <div class="kpis">
                <div class="kpi">
                  <small>üíß √Ågua hoje</small>
                  <b id="kpiAgua">0 ml</b>
                  <div class="tag" id="kpiAguaTag">Meta: --</div>
                </div>
                <div class="kpi">
                  <small>ü•© Prote√≠na hoje</small>
                  <b id="kpiProt">0 g</b>
                  <div class="tag" id="kpiProtTag">Meta: --</div>
                </div>
                <div class="kpi">
                  <small>üçë Ampulheta</small>
                  <b id="kpiRatio">--</b>
                  <div class="tag" id="kpiRatioTag">Gl√∫teo √∑ Cintura</div>
                </div>
              </div>

              <div class="divider"></div>

              <div class="row">
                <button class="btn" onclick="go('treino')">üìÖ Treino SEG‚ÄìSEX</button>
                <button class="btn secondary" onclick="go('agua')">üíß √Ågua</button>
                <button class="btn secondary" onclick="go('medidas')">üìè Medidas</button>
                <button class="btn secondary" onclick="go('fotos')">üì∏ Antes/Depois</button>
              </div>

              <div class="warnBox">
                <b>üéØ Foco Ampulheta (B):</b> costas + postura + core (v√°cuo) + gl√∫teo (hip thrust) = cintura mais marcada sem ‚Äúafinar pelo osso‚Äù.
              </div>

              <div class="divider"></div>

              <div class="row" style="justify-content:space-between">
                <div>
                  <b style="font-size:13px">üçë Gr√°fico de evolu√ß√£o (Gl√∫teo & Cintura)</b><br>
                  <span class="mini">Atualiza quando voc√™ salva medidas.</span>
                </div>
                <button class="btn ghost" onclick="resetMedidasConfirm()">üßπ zerar gr√°fico</button>
              </div>

              <div style="margin-top:10px; background:rgba(0,0,0,.18); border:1px solid rgba(255,255,255,.10); border-radius:16px; padding:10px;">
                <canvas id="chartGC" height="130"></canvas>
              </div>
            </div>
          </div>

          <div class="card" style="margin-top:14px;">
            <div class="hd">
              <div>
                <h2>‚úÖ Metas da Semana</h2>
                <p>Marque e veja seu progresso (autom√°tico)</p>
              </div>
              <button class="btn secondary" onclick="resetSemanaConfirm()">üîÑ Nova semana</button>
            </div>

            <div class="bd">
              <div class="chips">
                <div class="chip">üéØ Treinos alvo: <b id="metaTreinosTxt">4</b>/sem</div>
                <div class="chip">üíß √Ågua alvo: <b id="metaAguaTxt">2500</b> ml/dia</div>
                <div class="chip">ü•© Prote√≠na alvo: <b id="metaProtTxt">95</b> g/dia</div>
              </div>

              <div class="divider"></div>

              <div class="kpis">
                <div class="kpi">
                  <small>üèãÔ∏è Treinos feitos</small>
                  <b id="wkTreinos">0</b>
                  <div class="tag" id="wkTreinosTag">de 4</div>
                </div>
                <div class="kpi">
                  <small>üíß Dias batendo √°gua</small>
                  <b id="wkAgua">0</b>
                  <div class="tag" id="wkAguaTag">de 7</div>
                </div>
                <div class="kpi">
                  <small>ü•© Dias batendo prote√≠na</small>
                  <b id="wkProt">0</b>
                  <div class="tag" id="wkProtTag">de 7</div>
                </div>
              </div>

              <div class="divider"></div>

              <div class="row">
                <button class="btn" onclick="marcarTreinoHoje()">üèÅ Marcar treino feito hoje</button>
                <button class="btn secondary" onclick="openModal('metasModal')">‚öôÔ∏è Ajustar metas</button>
              </div>

              <div class="listSmall" id="wkLog"></div>
            </div>
          </div>

        </div>

        <!-- SE√á√ÉO: TREINO -->
        <div id="sec-treino" class="section">
          <div class="card">
            <div class="hd">
              <div>
                <h2>üìÖ Treino SEG‚ÄìSEX (Ampulheta)</h2>
                <p>Links em PT + espa√ßo para salvar sua carga/rep de cada exerc√≠cio</p>
              </div>
              <button class="btn secondary" onclick="openModal('cargasModal')">üìù Registrar cargas</button>
            </div>

            <div class="tabs" id="tabsTreino"></div>

            <div class="bd">
              <div class="chips">
                <div class="chip">‚è±Ô∏è Descanso: <b>principais 1m‚Äì1m30</b> ‚Ä¢ acess√≥rios <b>45s‚Äì1m</b></div>
                <div class="chip">üçë Regra: se completou reps com folga ‚Üí <b>sobe peso</b> na pr√≥xima</div>
                <div class="chip">üß† T√©cnica perfeita vale mais que carga</div>
              </div>

              <div class="ex" id="listaEx"></div>

              <div class="hint">
                <b>üí° Hip Thrust (eleva√ß√£o p√©lvica)</b> = apoio nas costas + for√ßa no calcanhar + aperta gl√∫teo no topo. √â o principal pra ‚Äúdevolver a bunda‚Äù üòÖüçë
              </div>
            </div>
          </div>
        </div>

        <!-- SE√á√ÉO: √ÅGUA -->
        <div id="sec-agua" class="section">
          <div class="card">
            <div class="hd">
              <div>
                <h2>üíß √Ågua (manual + m√©dia 7 dias)</h2>
                <p>Voc√™ digita ml e eu somo + mostro m√©dia</p>
              </div>
              <button class="btn secondary" onclick="zerarAguaHoje()">üßπ Zerar hoje</button>
            </div>

            <div class="bd">
              <div class="field">
                <label>üéØ Meta di√°ria de √°gua (ml)</label>
                <input type="number" id="aguaMeta" placeholder="Ex: 2500">
              </div>

              <div class="field">
                <label>‚ûï Adicionar manualmente (ml)</label>
                <input type="number" id="aguaAdd" placeholder="Ex: 470">
              </div>

              <div class="row">
                <button class="btn" onclick="addAguaManual()">‚ûï Somar</button>
                <button class="btn secondary" onclick="addAgua(470)">+470 ml</button>
                <button class="btn secondary" onclick="addAgua(250)">+250 ml</button>
                <button class="btn ghost" onclick="desfazerAgua()">‚Ü©Ô∏è Desfazer</button>
              </div>

              <div class="divider"></div>

              <div class="progress"><div class="bar" id="aguaBar"></div></div>
              <div class="kpis" style="margin-top:10px;">
                <div class="kpi">
                  <small>Hoje</small>
                  <b id="aguaHojeTxt">0 ml</b>
                  <div class="tag" id="aguaHojeTag">Meta: --</div>
                </div>
                <div class="kpi">
                  <small>üìä M√©dia (7 dias)</small>
                  <b id="aguaMedia7">0 ml</b>
                  <div class="tag">quanto mais constante, menos incha√ßo</div>
                </div>
                <div class="kpi">
                  <small>üßæ Hist√≥rico</small>
                  <b id="aguaDiasCount">0</b>
                  <div class="tag">dias registrados (7)</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- SE√á√ÉO: INTESTINO -->
        <div id="sec-intestino" class="section">
          <div class="card">
            <div class="hd">
              <div>
                <h2>üöΩ Intestino + Chia (monitoramento)</h2>
                <p>Pra voc√™ ver se realmente est√° ajudando üíõ</p>
              </div>
              <button class="btn secondary" onclick="resetIntestinoConfirm()">üßπ Limpar hist√≥rico</button>
            </div>

            <div class="bd">
              <div class="field">
                <label>Hoje voc√™ foi ao banheiro (n¬∫2)?</label>
                <select id="intFoi">
                  <option value="nao">N√£o</option>
                  <option value="sim">Sim</option>
                  <option value="pouco">Pouquinho</option>
                </select>
              </div>

              <div class="field">
                <label>‚úÖ √Ågua morna + 1 colher de chia (hidratou 10 min) em jejum?</label>
                <select id="intChia">
                  <option value="nao">N√£o</option>
                  <option value="sim">Sim</option>
                </select>
              </div>

              <div class="field">
                <label>Observa√ß√£o (opcional)</label>
                <textarea id="intObs" placeholder="Ex: 'hoje ajudou bem', 'barriga menos inchada', 'tive dor'..."></textarea>
              </div>

              <div class="row">
                <button class="btn" onclick="salvarIntestino()">Salvar</button>
                <button class="btn secondary" onclick="go('dash')">Voltar ao painel</button>
              </div>

              <div class="divider"></div>
              <b style="font-size:13px">üìå √öltimos registros</b>
              <div class="listSmall" id="intHist"></div>

              <div class="warnBox">
                <b>Dica:</b> se continuar ficando 1 semana sem evacuar, vale conversar com m√©dico (constipa√ß√£o cr√¥nica pode precisar ajuste de fibras, √°gua e at√© avalia√ß√£o).
              </div>
            </div>
          </div>
        </div>

        <!-- SE√á√ÉO: MEDIDAS -->
        <div id="sec-medidas" class="section">
          <div class="card">
            <div class="hd">
              <div>
                <h2>üìè Medidas + Propor√ß√£o Ampulheta</h2>
                <p>Cintura 72 / Gl√∫teo 96 ‚Üí a gente acompanha evolu√ß√£o üòè</p>
              </div>
              <button class="btn secondary" onclick="openModal('medidasListaModal')">üìú Ver hist√≥rico</button>
            </div>

            <div class="bd">
              <div class="row">
                <div class="field" style="flex:1; min-width:140px;">
                  <label>Peso (kg)</label>
                  <input type="number" id="mPeso" step="0.1" placeholder="Ex: 56.9">
                </div>
                <div class="field" style="flex:1; min-width:140px;">
                  <label>Cintura (cm)</label>
                  <input type="number" id="mCintura" step="0.1" placeholder="Ex: 72">
                </div>
                <div class="field" style="flex:1; min-width:140px;">
                  <label>Abd√¥men (cm)</label>
                  <input type="number" id="mAbdomen" step="0.1" placeholder="Ex: 81">
                </div>
                <div class="field" style="flex:1; min-width:140px;">
                  <label>Gl√∫teo (cm)</label>
                  <input type="number" id="mGluteo" step="0.1" placeholder="Ex: 96">
                </div>
              </div>

              <div class="row">
                <button class="btn" onclick="salvarMedidas()">Salvar medidas</button>
                <button class="btn ghost" onclick="preencherPadrao()">‚ú® Preencher com meus n√∫meros</button>
              </div>

              <div class="divider"></div>

              <div class="kpis">
                <div class="kpi">
                  <small>üçë Propor√ß√£o (Gl√∫teo √∑ Cintura)</small>
                  <b id="ratioTxt">--</b>
                  <div class="tag" id="ratioNota">--</div>
                </div>
                <div class="kpi">
                  <small>üìâ Cintura</small>
                  <b id="lastCintura">--</b>
                  <div class="tag">cm</div>
                </div>
                <div class="kpi">
                  <small>üìà Gl√∫teo</small>
                  <b id="lastGluteo">--</b>
                  <div class="tag">cm</div>
                </div>
              </div>

              <div class="hint">
                <b>üéØ Meta pr√°tica:</b> cintura tende a reduzir com consist√™ncia + menos incha√ßo; gl√∫teo cresce com hip thrust/leg/afundo + progress√£o.
              </div>
            </div>
          </div>
        </div>

        <!-- SE√á√ÉO: PROTE√çNA -->
        <div id="sec-proteina" class="section">
          <div class="card">
            <div class="hd">
              <div>
                <h2>ü•© Prote√≠na (meta + registro do dia)</h2>
                <p>Ajuda a ‚Äúsegurar‚Äù gl√∫teo e firmar o corpo</p>
              </div>
              <button class="btn secondary" onclick="resetProteinaHoje()">üßπ Zerar hoje</button>
            </div>

            <div class="bd">
              <div class="field">
                <label>üéØ Meta de prote√≠na (g/dia)</label>
                <input type="number" id="protMeta" placeholder="Ex: 95">
              </div>

              <div class="field">
                <label>‚ûï Somar prote√≠na (g) (manual)</label>
                <input type="number" id="protAdd" placeholder="Ex: 25">
              </div>

              <div class="row">
                <button class="btn" onclick="addProteinaManual()">‚ûï Somar</button>
                <button class="btn secondary" onclick="addProteina(25)">+25g</button>
                <button class="btn secondary" onclick="addProteina(15)">+15g</button>
                <button class="btn ghost" onclick="desfazerProteina()">‚Ü©Ô∏è Desfazer</button>
              </div>

              <div class="divider"></div>

              <div class="progress"><div class="bar" id="protBar"></div></div>

              <div class="kpis" style="margin-top:10px;">
                <div class="kpi">
                  <small>Hoje</small>
                  <b id="protHojeTxt">0 g</b>
                  <div class="tag" id="protHojeTag">Meta: --</div>
                </div>
                <div class="kpi">
                  <small>üìä M√©dia (7 dias)</small>
                  <b id="protMedia7">0 g</b>
                  <div class="tag">consist√™ncia = resultado</div>
                </div>
                <div class="kpi">
                  <small>‚úÖ Dias batidos (7)</small>
                  <b id="protDiasOk">0</b>
                  <div class="tag">meta atingida</div>
                </div>
              </div>

              <div class="warnBox">
                <b>Base econ√¥mica:</b> frango, ovos, feij√£o, iogurte natural, sardinha, patinho mo√≠do (quando der), queijo com modera√ß√£o.
              </div>
            </div>
          </div>
        </div>

        <!-- SE√á√ÉO: FOTOS -->
        <div id="sec-fotos" class="section">
          <div class="card">
            <div class="hd">
              <div>
                <h2>üì∏ Antes / Depois (salva no seu navegador)</h2>
                <p>Voc√™ adiciona foto e fica guardado s√≥ pra voc√™</p>
              </div>
              <button class="btn secondary" onclick="resetFotosConfirm()">üßπ Limpar fotos</button>
            </div>

            <div class="bd">
              <div class="field">
                <label>Adicionar foto (antes/depois)</label>
                <input type="file" id="fotoFile" accept="image/*">
              </div>

              <div class="field">
                <label>Legenda (opcional)</label>
                <input type="text" id="fotoLegenda" placeholder="Ex: 'Antes', 'Depois 2 doses', 'Fev/2026'...">
              </div>

              <div class="row">
                <button class="btn" onclick="addFoto()">‚ûï Salvar foto</button>
                <button class="btn secondary" onclick="go('dash')">Voltar</button>
              </div>

              <div class="divider"></div>

              <div id="galeria" style="display:grid; grid-template-columns: repeat(2, 1fr); gap:10px;"></div>
              <div class="mini" style="margin-top:10px;color:var(--muted2);">
                Dica: se quiser comparar melhor, tire fotos sempre no mesmo lugar/luz e mesma dist√¢ncia.
              </div>
            </div>
          </div>
        </div>

      </div>

      <!-- COLUNA LATERAL (atalhos r√°pidos) -->
      <div class="col">
        <div class="card">
          <div class="hd">
            <div>
              <h2>‚ö° Atalhos</h2>
              <p>um toque e pronto</p>
            </div>
          </div>
          <div class="bd">
            <div class="row">
              <button class="btn" onclick="go('agua')">üíß √Ågua</button>
              <button class="btn" onclick="go('proteina')">ü•© Prote√≠na</button>
              <button class="btn" onclick="go('intestino')">üöΩ Intestino</button>
              <button class="btn" onclick="go('medidas')">üìè Medidas</button>
              <button class="btn secondary" onclick="openModal('peitoModal')">üíó Peito firme</button>
            </div>

            <div class="divider"></div>

            <div class="hint">
              <b>üíó Sobre peito (silicone + emagrecimento):</b><br>
              Exerc√≠cio n√£o ‚Äúlevanta‚Äù pele solta, mas <b>melhora MUITO</b> o colo e sustenta√ß√£o visual fortalecendo peitoral e postura.
            </div>

            <div class="divider"></div>

            <b style="font-size:13px">üçΩÔ∏è Dieta econ√¥mica (sem tapioca)</b>
            <div class="listSmall" id="dietaTxt"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- MENU INFERIOR (tipo app/instagram) -->
  <div class="bottomNav">
    <div class="navRow">
      <div class="navBtn active" id="nav-dash" onclick="go('dash')"><span>üè†</span>In√≠cio</div>
      <div class="navBtn" id="nav-treino" onclick="go('treino')"><span>üèãÔ∏è</span>Treino</div>
      <div class="navBtn" id="nav-agua" onclick="go('agua')"><span>üíß</span>√Ågua</div>
      <div class="navBtn" id="nav-medidas" onclick="go('medidas')"><span>üìè</span>Medidas</div>
      <div class="navBtn" id="nav-fotos" onclick="go('fotos')"><span>üì∏</span>Fotos</div>
    </div>
  </div>

  <!-- MODAIS -->
  <div class="modalBack" id="ajudaModal">
    <div class="modal">
      <div class="mhd">
        <b>‚ú® Como instalar no celular</b>
        <button class="xbtn" onclick="closeModal('ajudaModal')">‚úï</button>
      </div>
      <div class="mbd">
        <div class="warnBox">
          <b>Android (Chrome):</b> abra o site ‚Üí menu ‚ãÆ ‚Üí <b>Instalar app</b>.<br><br>
          <b>iPhone (Safari):</b> compartilhar ‚Üí <b>Adicionar √† Tela de In√≠cio</b>.<br><br>
          Se n√£o aparecer, aguarde 1‚Äì3 min ap√≥s atualizar o GitHub Pages.
        </div>
        <div class="row" style="margin-top:10px;">
          <button class="btn" onclick="closeModal('ajudaModal')">Entendi ‚úÖ</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modalBack" id="metasModal">
    <div class="modal">
      <div class="mhd">
        <b>‚öôÔ∏è Ajustar metas semanais</b>
        <button class="xbtn" onclick="closeModal('metasModal')">‚úï</button>
      </div>
      <div class="mbd">
        <div class="row">
          <div class="field" style="flex:1; min-width:150px;">
            <label>Treinos alvo/semana</label>
            <input type="number" id="metaTreinos" min="1" max="7">
          </div>
          <div class="field" style="flex:1; min-width:150px;">
            <label>√Ågua alvo (ml/dia)</label>
            <input type="number" id="metaAgua" min="500" step="50">
          </div>
          <div class="field" style="flex:1; min-width:150px;">
            <label>Prote√≠na alvo (g/dia)</label>
            <input type="number" id="metaProt" min="30" step="1">
          </div>
        </div>
        <div class="row">
          <button class="btn" onclick="salvarMetas()">Salvar metas ‚úÖ</button>
          <button class="btn secondary" onclick="closeModal('metasModal')">Fechar</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modalBack" id="cargasModal">
    <div class="modal">
      <div class="mhd">
        <b>üìù Registrar cargas</b>
        <button class="xbtn" onclick="closeModal('cargasModal')">‚úï</button>
      </div>
      <div class="mbd">
        <div class="warnBox">
          Aqui voc√™ salva <b>peso</b> e <b>reps</b> por exerc√≠cio (fica guardado no seu celular).  
          Dica: anota a carga mais pesada que voc√™ fez com t√©cnica bonita üíÖ
        </div>
        <div class="field">
          <label>Exerc√≠cio</label>
          <select id="cgEx"></select>
        </div>
        <div class="row">
          <div class="field" style="flex:1; min-width:160px;">
            <label>Carga (kg)</label>
            <input type="number" id="cgKg" step="0.5" placeholder="Ex: 18">
          </div>
          <div class="field" style="flex:1; min-width:160px;">
            <label>Reps</label>
            <input type="number" id="cgReps" placeholder="Ex: 12">
          </div>
        </div>

        <div class="row">
          <button class="btn" onclick="salvarCarga()">Salvar ‚úÖ</button>
          <button class="btn ghost" onclick="limparCarga()">üßπ Limpar</button>
        </div>

        <div class="divider"></div>
        <b style="font-size:13px">üìå √öltimos registros</b>
        <div class="listSmall" id="cgHist"></div>
      </div>
    </div>
  </div>

  <div class="modalBack" id="medidasListaModal">
    <div class="modal">
      <div class="mhd">
        <b>üìú Hist√≥rico de medidas</b>
        <button class="xbtn" onclick="closeModal('medidasListaModal')">‚úï</button>
      </div>
      <div class="mbd">
        <div class="listSmall" id="medidasHist"></div>
        <div class="row" style="margin-top:10px;">
          <button class="btn secondary" onclick="closeModal('medidasListaModal')">Fechar</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modalBack" id="peitoModal">
    <div class="modal">
      <div class="mhd">
        <b>üíó Exerc√≠cios para colo/postura (ajuda no visual do peito)</b>
        <button class="xbtn" onclick="closeModal('peitoModal')">‚úï</button>
      </div>
      <div class="mbd">
        <div class="warnBox">
          <b>Inclui no seu treino (Ter√ßa ou Quinta):</b><br>
          ‚Ä¢ <b>Supino inclinado m√°quina</b> 3√ó12<br>
          ‚Ä¢ <b>Crucifixo m√°quina</b> 3√ó12<br>
          ‚Ä¢ <b>Face Pull</b> 3√ó15 (postura e ‚Äúpeito pra cima‚Äù)<br><br>
          Isso n√£o troca cirurgia, mas melhora MUITO sustenta√ß√£o visual + firmeza do colo.
        </div>
        <div class="row" style="margin-top:10px;">
          <button class="btn" onclick="go('treino'); closeModal('peitoModal')">Ver no treino ‚úÖ</button>
        </div>
      </div>
    </div>
  </div>

<script>
  /********************
   * DADOS + STORAGE
   ********************/
  const KEY = "app_ampulheta_miria_ultra";

  function hojeISO(){
    return new Date().toISOString().slice(0,10);
  }

  function getWeekKey(date = new Date()){
    // semana baseada em "segunda" como in√≠cio
    const d = new Date(date);
    const day = (d.getDay() + 6) % 7; // seg=0 ... dom=6
    d.setDate(d.getDate() - day);
    return d.toISOString().slice(0,10); // monday ISO
  }

  let db = JSON.parse(localStorage.getItem(KEY)) || {
    metas: { treinosSemana: 4, aguaDia: 2500, protDia: 95 },
    agua: {},         // { 'YYYY-MM-DD': {total, stack[]} }
    proteina: {},     // { 'YYYY-MM-DD': {total, stack[]} }
    intestino: {},    // { 'YYYY-MM-DD': {foi, chia, obs} }
    medidas: [],      // [{data,peso,cintura,abdomen,gluteo}]
    cargas: [],       // [{data,ex,kg,reps}]
    treinoFeito: {},  // {weekKey: {'YYYY-MM-DD':true}}
    fotos: []         // [{data, legenda, dataUrl}]
  };

  function save(){
    localStorage.setItem(KEY, JSON.stringify(db));
    refreshAll();
  }

  /********************
   * NAVEGA√á√ÉO
   ********************/
  function go(sec){
    // sections
    const map = {
      dash: "sec-dash",
      treino: "sec-treino",
      agua: "sec-agua",
      intestino: "sec-intestino",
      medidas: "sec-medidas",
      proteina: "sec-proteina",
      fotos: "sec-fotos"
    };
    document.querySelectorAll(".section").forEach(s => s.classList.remove("active"));
    document.getElementById(map[sec]).classList.add("active");

    // bottom nav highlight
    ["dash","treino","agua","medidas","fotos"].forEach(k=>{
      const el = document.getElementById("nav-"+k);
      if(el) el.classList.toggle("active", k===sec);
    });

    // se a pessoa abrir prote√≠na ou intestino pelo painel lateral, menu n√£o tem bot√£o - ok.
    if(sec==="treino") renderTreino();
    if(sec==="fotos") renderGaleria();
    if(sec==="medidas") updateMedidasUI();
    if(sec==="agua") updateAguaUI();
    if(sec==="proteina") updateProteinaUI();
    if(sec==="intestino") updateIntestinoUI();
  }

  function openModal(id){ document.getElementById(id).classList.add("show"); }
  function closeModal(id){ document.getElementById(id).classList.remove("show"); }

  /********************
   * TREINO (SEG‚ÄìSEX) + V√çDEOS
   ********************/
  const treino = {
    seg: {
      nome: "Segunda ‚Ä¢ Gl√∫teo / Posterior üçë",
      itens: [
        { id:"cadeira_flexora", n:"1Ô∏è‚É£ Cadeira Flexora", s:"3√ó12", w:"üëâ 20‚Äì25kg", t:"Controle total. Sem tirar o quadril do banco.", v:"https://www.youtube.com/results?search_query=cadeira+flexora+como+fazer+correto" },
        { id:"stiff_halter", n:"2Ô∏è‚É£ Stiff com Halter", s:"3√ó12", w:"üëâ 6‚Äì8kg cada lado", t:"Coluna neutra. Desce devagar. Sente alongar posterior.", v:"https://www.youtube.com/results?search_query=stiff+com+halter+como+fazer" },
        { id:"hip_thrust", n:"3Ô∏è‚É£ Eleva√ß√£o p√©lvica (Hip Thrust)", s:"4√ó10", w:"üëâ 20kg (meta evoluir)", t:"Pausa 1s no topo. N√£o arquear lombar.", v:"https://www.youtube.com/results?search_query=eleva%C3%A7%C3%A3o+p%C3%A9lvica+como+fazer" },
        { id:"abdutora", n:"4Ô∏è‚É£ Abdutora m√°quina", s:"3√ó15", w:"üëâ 30‚Äì35kg", t:"Inclina levemente pra frente e segura 1s aberta.", v:"https://www.youtube.com/results?search_query=abdutora+m%C3%A1quina+como+usar" },
        { id:"cardio_inclinada", n:"üö∂‚Äç‚ôÄÔ∏è Cardio (opcional)", s:"12 min", w:"üëâ esteira inclinada", t:"Leve/moderado pra ajudar barriga sem perder gl√∫teo.", v:"https://www.youtube.com/results?search_query=esteira+inclinada+como+fazer" }
      ]
    },
    ter: {
      nome: "Ter√ßa ‚Ä¢ Peito + Ombro + Cintura üíó",
      itens: [
        { id:"supino_inclinado", n:"1Ô∏è‚É£ Supino inclinado m√°quina", s:"3√ó12", w:"üëâ 15‚Äì20kg", t:"Peito aberto. Ombros pra baixo.", v:"https://www.youtube.com/results?search_query=supino+inclinado+m%C3%A1quina+como+fazer" },
        { id:"crucifixo_maquina", n:"2Ô∏è‚É£ Crucifixo m√°quina", s:"3√ó12", w:"üëâ 15kg", t:"Controlado. N√£o esticar demais.", v:"https://www.youtube.com/results?search_query=crucifixo+m%C3%A1quina+como+fazer" },
        { id:"elevacao_lateral", n:"3Ô∏è‚É£ Eleva√ß√£o lateral halter", s:"3√ó12", w:"üëâ 4kg", t:"Sobe at√© linha do ombro. Sem balan√ßar.", v:"https://www.youtube.com/results?search_query=eleva%C3%A7%C3%A3o+lateral+halter+como+fazer" },
        { id:"desenvolvimento_ombro", n:"4Ô∏è‚É£ Desenvolvimento ombro halter", s:"3√ó10", w:"üëâ 6kg", t:"Controle. N√£o jogar a lombar.", v:"https://www.youtube.com/results?search_query=desenvolvimento+ombro+halter+como+fazer" },
        { id:"vacuo", n:"‚è≥ V√°cuo abdominal (cintura)", s:"3√ó20s", w:"üëâ cintura marcada", t:"Solta o ar e puxa o umbigo pra dentro.", v:"https://www.youtube.com/results?search_query=vacuum+abdominal+como+fazer" }
      ]
    },
    qua: {
      nome: "Quarta ‚Ä¢ Quadr√≠ceps + Gl√∫teo üî•",
      itens: [
        { id:"leg_press", n:"1Ô∏è‚É£ Leg Press", s:"4√ó12", w:"üëâ 80kg (meta 100‚Äì110kg)", t:"P√© um pouco mais alto. N√£o travar joelho.", v:"https://www.youtube.com/results?search_query=leg+press+como+fazer+correto" },
        { id:"smith_agacha", n:"2Ô∏è‚É£ Agachamento no Smith", s:"3√ó10", w:"üëâ 10kg cada lado", t:"P√©s levemente √† frente. Desce controlado.", v:"https://www.youtube.com/results?search_query=agachamento+no+smith+como+fazer" },
        { id:"extensora", n:"3Ô∏è‚É£ Cadeira Extensora", s:"3√ó12", w:"üëâ 25kg", t:"Sobe forte e desce controlando.", v:"https://www.youtube.com/results?search_query=cadeira+extensora+como+fazer" },
        { id:"abdutora2", n:"4Ô∏è‚É£ Abdutora (gl√∫teo lateral)", s:"3√ó15", w:"üëâ 30‚Äì35kg", t:"Foco no gl√∫teo lateral (ajuda ampulheta).", v:"https://www.youtube.com/results?search_query=abdutora+m%C3%A1quina+como+usar" }
      ]
    },
    qui: {
      nome: "Quinta ‚Ä¢ Costas + Postura + Core üß†",
      itens: [
        { id:"puxada_frente", n:"1Ô∏è‚É£ Puxada frente", s:"3√ó12", w:"üëâ 25kg", t:"Puxa com cotovelos. Ombros pra baixo.", v:"https://www.youtube.com/results?search_query=puxada+frente+na+polia+como+fazer" },
        { id:"remada_baixa", n:"2Ô∏è‚É£ Remada baixa", s:"3√ó12", w:"üëâ 25kg", t:"Segura 1s atr√°s. Postura firme.", v:"https://www.youtube.com/results?search_query=remada+baixa+na+polia+como+fazer" },
        { id:"face_pull", n:"3Ô∏è‚É£ Face Pull", s:"3√ó15", w:"üëâ leve/m√©dio", t:"Postura + colo bonito. Cotovelos altos.", v:"https://www.youtube.com/results?search_query=face+pull+como+fazer" },
        { id:"prancha", n:"4Ô∏è‚É£ Prancha", s:"3√ó40s", w:"üëâ core firme", t:"Barriga pra dentro. Sem cair lombar.", v:"https://www.youtube.com/results?search_query=prancha+abdominal+como+fazer" }
      ]
    },
    sex: {
      nome: "Sexta ‚Ä¢ Gl√∫teo Foco + Cintura üçë",
      itens: [
        { id:"hip_thrust_pesado", n:"1Ô∏è‚É£ Eleva√ß√£o p√©lvica (pesado)", s:"4√ó8", w:"üëâ 30kg (meta 45kg)", t:"Forma perfeita. Pausa no topo.", v:"https://www.youtube.com/results?search_query=hip+thrust+como+fazer" },
        { id:"stiff2", n:"2Ô∏è‚É£ Stiff", s:"3√ó12", w:"üëâ 8kg cada lado", t:"Controle, coluna neutra.", v:"https://www.youtube.com/results?search_query=stiff+com+halter+como+fazer" },
        { id:"afundo", n:"3Ô∏è‚É£ Afundo andando", s:"3√ó10 cada perna", w:"üëâ 4‚Äì6kg", t:"Tronco levemente √† frente, calcanhar empurra.", v:"https://www.youtube.com/results?search_query=afundo+andando+como+fazer" },
        { id:"abdutora3", n:"4Ô∏è‚É£ Abdutora", s:"4√ó15", w:"üëâ 35‚Äì40kg", t:"Segura 1s aberta. Gl√∫teo lateral.", v:"https://www.youtube.com/results?search_query=abdutora+m%C3%A1quina+como+usar" },
        { id:"vacuo2", n:"‚è≥ V√°cuo abdominal", s:"3√ó20s", w:"üëâ cintura", t:"Consist√™ncia 3x/semana.", v:"https://www.youtube.com/results?search_query=vacuum+abdominal+como+fazer" }
      ]
    }
  };

  const orderDays = ["seg","ter","qua","qui","sex"];
  let diaAtivo = "seg";

  function renderTabs(){
    const tabs = document.getElementById("tabsTreino");
    tabs.innerHTML = "";
    orderDays.forEach(d=>{
      const t = document.createElement("div");
      t.className = "tab"+(d===diaAtivo ? " active":"");
      t.textContent = d.toUpperCase();
      t.onclick = ()=>{ diaAtivo=d; renderTabs(); renderTreino(); };
      tabs.appendChild(t);
    });
  }

  function renderTreino(){
    renderTabs();
    const box = document.getElementById("listaEx");
    const day = treino[diaAtivo];
    box.innerHTML = "";

    // t√≠tulo do dia (no topo da lista)
    const h = document.createElement("div");
    h.className = "exItem";
    h.innerHTML = `
      <div class="exTop">
        <div><b>${day.nome}</b><div class="mini">Clique em ‚ÄúVer v√≠deo (PT)‚Äù para ver execu√ß√£o correta</div></div>
        <small>üìå Salve cargas no bot√£o ‚ÄúRegistrar cargas‚Äù</small>
      </div>
    `;
    box.appendChild(h);

    day.itens.forEach(item=>{
      const div = document.createElement("div");
      div.className = "exItem";

      const last = lastCarga(item.id);
      const lastTxt = last ? `√öltimo: <b>${last.kg}kg</b> ‚Ä¢ ${last.reps} reps (${last.data})` : `Sem registro ainda`;

      div.innerHTML = `
        <div class="exTop">
          <div>
            <b>${item.n}</b><br>
            <span class="mini">${item.s} ‚Ä¢ ${item.w}</span>
          </div>
          <small>${lastTxt}</small>
        </div>
        <div class="exTips">üí° ${item.t}</div>
        <div class="exActions">
          <a class="link" href="${item.v}" target="_blank" rel="noopener">‚ñ∂Ô∏è Ver v√≠deo (PT)</a>
          <span class="mini">ID: ${item.id}</span>
        </div>
      `;
      box.appendChild(div);
    });

    // Atualiza select do modal de cargas
    const cgEx = document.getElementById("cgEx");
    cgEx.innerHTML = "";
    orderDays.forEach(d=>{
      treino[d].itens.forEach(i=>{
        const opt = document.createElement("option");
        opt.value = i.id;
        opt.textContent = `${i.n.replace(/\\dÔ∏è‚É£\\s*/,"")} (${d.toUpperCase()})`;
        cgEx.appendChild(opt);
      });
    });
  }

  function lastCarga(exId){
    const list = db.cargas.filter(x=>x.ex===exId);
    if(!list.length) return null;
    return list[list.length-1];
  }

  function salvarCarga(){
    const ex = document.getElementById("cgEx").value;
    const kg = Number(document.getElementById("cgKg").value);
    const reps = Number(document.getElementById("cgReps").value);
    if(!ex || !kg || !reps) { alert("Preenche exerc√≠cio + kg + reps üòâ"); return; }

    db.cargas.push({ data: hojeISO(), ex, kg, reps });
    document.getElementById("cgKg").value = "";
    document.getElementById("cgReps").value = "";
    save();
    updateCargasHist();
    renderTreino();
  }

  function limparCarga(){
    document.getElementById("cgKg").value = "";
    document.getElementById("cgReps").value = "";
  }

  function updateCargasHist(){
    const box = document.getElementById("cgHist");
    const last = db.cargas.slice(-10).reverse();
    box.innerHTML = last.length ? last.map(x=>`‚Ä¢ <b>${x.ex}</b> ‚Äî ${x.kg}kg / ${x.reps} reps <span class="mini">(${x.data})</span>`).join("<br>") : "Sem registros ainda.";
  }

  /********************
   * √ÅGUA
   ********************/
  function ensureAguaToday(){
    const k = hojeISO();
    if(!db.agua[k]) db.agua[k] = { total:0, stack:[] };
  }

  function addAgua(v){
    ensureAguaToday();
    const k = hojeISO();
    db.agua[k].total += v;
    db.agua[k].stack.push(v);
    save();
  }

  function addAguaManual(){
    const v = Number(document.getElementById("aguaAdd").value);
    if(!v || v<=0) return;
    addAgua(v);
    document.getElementById("aguaAdd").value = "";
  }

  function desfazerAgua(){
    ensureAguaToday();
    const k = hojeISO();
    const u = db.agua[k].stack.pop();
    if(u) db.agua[k].total -= u;
    save();
  }

  function zerarAguaHoje(){
    const k = hojeISO();
    db.agua[k] = { total:0, stack:[] };
    save();
  }

  function updateAguaUI(){
    ensureAguaToday();
    document.getElementById("aguaMeta").value = db.metas.aguaDia;

    const k = hojeISO();
    const total = db.agua[k].total;
    const meta = Number(db.metas.aguaDia);

    document.getElementById("aguaHojeTxt").textContent = `${total} ml`;
    document.getElementById("aguaHojeTag").textContent = `Meta: ${meta} ml`;

    const pct = Math.min(100, Math.round((total/meta)*100));
    document.getElementById("aguaBar").style.width = pct + "%";

    // 7 dias
    let soma=0, dias=0;
    let okDays=0;
    for(let i=0;i<7;i++){
      const d = new Date(); d.setDate(d.getDate()-i);
      const key = d.toISOString().slice(0,10);
      if(db.agua[key]){
        soma += db.agua[key].total;
        dias++;
        if(db.agua[key].total >= meta) okDays++;
      }
    }
    const media = dias ? Math.round(soma/dias) : 0;
    document.getElementById("aguaMedia7").textContent = `${media} ml`;
    document.getElementById("aguaDiasCount").textContent = dias;

    // kpi
    document.getElementById("kpiAgua").textContent = `${total} ml`;
    document.getElementById("kpiAguaTag").textContent = `Meta: ${meta} ml`;
  }

  /********************
   * PROTE√çNA
   ********************/
  function ensureProtToday(){
    const k = hojeISO();
    if(!db.proteina[k]) db.proteina[k] = { total:0, stack:[] };
  }

  function addProteina(v){
    ensureProtToday();
    const k = hojeISO();
    db.proteina[k].total += v;
    db.proteina[k].stack.push(v);
    save();
  }

  function addProteinaManual(){
    const v = Number(document.getElementById("protAdd").value);
    if(!v || v<=0) return;
    addProteina(v);
    document.getElementById("protAdd").value = "";
  }

  function desfazerProteina(){
    ensureProtToday();
    const k = hojeISO();
    const u = db.proteina[k].stack.pop();
    if(u) db.proteina[k].total -= u;
    save();
  }

  function resetProteinaHoje(){
    const k = hojeISO();
    db.proteina[k] = { total:0, stack:[] };
    save();
  }

  function updateProteinaUI(){
    ensureProtToday();
    document.getElementById("protMeta").value = db.metas.protDia;

    const k = hojeISO();
    const total = db.proteina[k].total;
    const meta = Number(db.metas.protDia);

    document.getElementById("protHojeTxt").textContent = `${total} g`;
    document.getElementById("protHojeTag").textContent = `Meta: ${meta} g`;

    const pct = Math.min(100, Math.round((total/meta)*100));
    document.getElementById("protBar").style.width = pct + "%";

    // 7 dias
    let soma=0, dias=0, ok=0;
    for(let i=0;i<7;i++){
      const d = new Date(); d.setDate(d.getDate()-i);
      const key = d.toISOString().slice(0,10);
      if(db.proteina[key]){
        soma += db.proteina[key].total;
        dias++;
        if(db.proteina[key].total >= meta) ok++;
      }
    }
    const media = dias ? Math.round(soma/dias) : 0;

    document.getElementById("protMedia7").textContent = `${media} g`;
    document.getElementById("protDiasOk").textContent = ok;

    // kpi
    document.getElementById("kpiProt").textContent = `${total} g`;
    document.getElementById("kpiProtTag").textContent = `Meta: ${meta} g`;
  }

  /********************
   * INTESTINO
   ********************/
  function salvarIntestino(){
    const k = hojeISO();
    db.intestino[k] = {
      foi: document.getElementById("intFoi").value,
      chia: document.getElementById("intChia").value,
      obs: document.getElementById("intObs").value.trim()
    };
    document.getElementById("intObs").value = "";
    save();
  }

  function updateIntestinoUI(){
    const arr = Object.entries(db.intestino).sort((a,b)=>a[0].localeCompare(b[0])).slice(-14).reverse();
    const box = document.getElementById("intHist");
    box.innerHTML = arr.length ? arr.map(([d,v])=>{
      const chia = v.chia==="sim" ? " + chia ‚úÖ" : "";
      const obs = v.obs ? ` ‚Äî <i>${escapeHtml(v.obs)}</i>` : "";
      return `‚Ä¢ <b>${d}</b> ‚Äî ${v.foi}${chia}${obs}`;
    }).join("<br>") : "Sem registros ainda. Bora acompanhar üíõ";
  }

  function resetIntestinoConfirm(){
    if(confirm("Apagar TODO hist√≥rico de intestino?")){ db.intestino = {}; save(); }
  }

  /********************
   * MEDIDAS + AMPULHETA + GR√ÅFICO REAL
   ********************/
  function preencherPadrao(){
    document.getElementById("mPeso").value = 56.9;
    document.getElementById("mCintura").value = 72;
    document.getElementById("mAbdomen").value = 81;
    document.getElementById("mGluteo").value = 96;
  }

  function salvarMedidas(){
    const obj = {
      data: hojeISO(),
      peso: Number(document.getElementById("mPeso").value) || null,
      cintura: Number(document.getElementById("mCintura").value) || null,
      abdomen: Number(document.getElementById("mAbdomen").value) || null,
      gluteo: Number(document.getElementById("mGluteo").value) || null
    };
    if(!obj.cintura || !obj.gluteo){
      alert("Preenche pelo menos CINTURA e GL√öTEO üòâ");
      return;
    }
    db.medidas.push(obj);
    save();
  }

  function ratioNota(r){
    // heur√≠stica simples (visual)
    if(!r) return {txt:"--", nota:"--"};
    if(r >= 1.33) return {txt:r.toFixed(2), nota:"üî• Ampulheta bem marcada"};
    if(r >= 1.25) return {txt:r.toFixed(2), nota:"‚ú® Ampulheta evidente"};
    if(r >= 1.18) return {txt:r.toFixed(2), nota:"üíó Natural (boa base)"};
    return {txt:r.toFixed(2), nota:"üå± Em constru√ß√£o (bora evoluir)"};
  }

  function updateMedidasUI(){
    const last = db.medidas[db.medidas.length-1];
    if(!last){
      document.getElementById("ratioTxt").textContent = "--";
      document.getElementById("ratioNota").textContent = "--";
      document.getElementById("lastCintura").textContent = "--";
      document.getElementById("lastGluteo").textContent = "--";
      document.getElementById("kpiRatio").textContent = "--";
      renderChart();
      return;
    }

    const r = last.gluteo && last.cintura ? (last.gluteo/last.cintura) : null;
    const rn = ratioNota(r);

    document.getElementById("ratioTxt").textContent = rn.txt;
    document.getElementById("ratioNota").textContent = rn.nota;
    document.getElementById("lastCintura").textContent = last.cintura ?? "--";
    document.getElementById("lastGluteo").textContent = last.gluteo ?? "--";

    document.getElementById("kpiRatio").textContent = rn.txt;
    document.getElementById("kpiRatioTag").textContent = rn.nota;

    // hist√≥rico modal
    const hist = db.medidas.slice(-30).reverse().map(m=>{
      const rr = (m.gluteo && m.cintura) ? (m.gluteo/m.cintura) : null;
      const rrTxt = rr ? rr.toFixed(2) : "--";
      return `‚Ä¢ <b>${m.data}</b> ‚Äî Peso: ${m.peso ?? "--"}kg | Cintura: ${m.cintura} | Abd: ${m.abdomen ?? "--"} | Gl√∫teo: ${m.gluteo} | Ratio: <b>${rrTxt}</b>`;
    }).join("<br>");
    document.getElementById("medidasHist").innerHTML = hist || "Sem registros ainda.";

    renderChart();
  }

  let chartGC;
  function renderChart(){
    const ctx = document.getElementById("chartGC");
    if(!ctx) return;

    const xs = db.medidas.slice(-12); // √∫ltimas 12 medi√ß√µes
    const labels = xs.map(x=>x.data.slice(5));
    const gl = xs.map(x=>x.gluteo);
    const ci = xs.map(x=>x.cintura);

    if(chartGC){ chartGC.destroy(); }

    chartGC = new Chart(ctx, {
      type: "line",
      data: {
        labels,
        datasets: [
          { label: "Gl√∫teo (cm)", data: gl, tension:.35, borderWidth:2 },
          { label: "Cintura (cm)", data: ci, tension:.35, borderWidth:2 }
        ]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { labels: { color: "rgba(255,255,255,.85)" } }
        },
        scales: {
          x: { ticks: { color:"rgba(255,255,255,.65)" }, grid:{ color:"rgba(255,255,255,.08)" } },
          y: { ticks: { color:"rgba(255,255,255,.65)" }, grid:{ color:"rgba(255,255,255,.08)" } }
        }
      }
    });
  }

  function resetMedidasConfirm(){
    if(confirm("Zerar TODAS as medidas (e gr√°fico)?")){
      db.medidas = [];
      save();
    }
  }

  /********************
   * METAS SEMANAIS
   ********************/
  function salvarMetas(){
    const t = Number(document.getElementById("metaTreinos").value);
    const a = Number(document.getElementById("metaAgua").value);
    const p = Number(document.getElementById("metaProt").value);
    if(!t || !a || !p) { alert("Preenche as 3 metas üòâ"); return; }

    db.metas.treinosSemana = t;
    db.metas.aguaDia = a;
    db.metas.protDia = p;

    // tamb√©m atualiza inputs das telas
    closeModal("metasModal");
    save();
  }

  function marcarTreinoHoje(){
    const wk = getWeekKey();
    if(!db.treinoFeito[wk]) db.treinoFeito[wk] = {};
    db.treinoFeito[wk][hojeISO()] = true;
    save();
    alert("Treino marcado ‚úÖüî•");
  }

  function resetSemanaConfirm(){
    if(confirm("Come√ßar uma NOVA semana (zera contadores dessa semana)?")){
      const wk = getWeekKey();
      db.treinoFeito[wk] = {};
      save();
    }
  }

  function updateSemanaUI(){
    const wk = getWeekKey();
    const treinosMap = db.treinoFeito[wk] || {};
    const treinosCount = Object.keys(treinosMap).length;

    const metaTreinos = db.metas.treinosSemana;
    document.getElementById("wkTreinos").textContent = treinosCount;
    document.getElementById("wkTreinosTag").textContent = `de ${metaTreinos}`;

    // √°gua/prote√≠na: conta √∫ltimos 7 dias a partir de hoje
    const metaAgua = db.metas.aguaDia;
    const metaProt = db.metas.protDia;

    let okAgua=0, okProt=0;
    for(let i=0;i<7;i++){
      const d = new Date(); d.setDate(d.getDate()-i);
      const key = d.toISOString().slice(0,10);

      if(db.agua[key] && db.agua[key].total >= metaAgua) okAgua++;
      if(db.proteina[key] && db.proteina[key].total >= metaProt) okProt++;
    }

    document.getElementById("wkAgua").textContent = okAgua;
    document.getElementById("wkAguaTag").textContent = "de 7";
    document.getElementById("wkProt").textContent = okProt;
    document.getElementById("wkProtTag").textContent = "de 7";

    // metas chips
    document.getElementById("metaTreinosTxt").textContent = metaTreinos;
    document.getElementById("metaAguaTxt").textContent = metaAgua;
    document.getElementById("metaProtTxt").textContent = metaProt;

    // modal inputs
    document.getElementById("metaTreinos").value = metaTreinos;
    document.getElementById("metaAgua").value = metaAgua;
    document.getElementById("metaProt").value = metaProt;

    // log simples
    const dias = Object.keys(treinosMap).sort().reverse().slice(0,7);
    document.getElementById("wkLog").innerHTML = dias.length
      ? ("<b>üìå Treinos marcados:</b><br>" + dias.map(d=>`‚Ä¢ ${d}`).join("<br>"))
      : "Nenhum treino marcado nessa semana ainda.";
  }

  /********************
   * FOTOS (antes/depois) ‚Äì salva dataURL
   ********************/
  function addFoto(){
    const input = document.getElementById("fotoFile");
    const file = input.files && input.files[0];
    if(!file){ alert("Escolha uma foto üòâ"); return; }

    const legenda = document.getElementById("fotoLegenda").value.trim();

    const reader = new FileReader();
    reader.onload = () => {
      db.fotos.unshift({ data: hojeISO(), legenda, dataUrl: reader.result });
      document.getElementById("fotoLegenda").value = "";
      input.value = "";
      save();
      renderGaleria();
      alert("Foto salva ‚úÖüì∏");
    };
    reader.readAsDataURL(file);
  }

  function renderGaleria(){
    const box = document.getElementById("galeria");
    if(!box) return;

    box.innerHTML = "";
    if(!db.fotos.length){
      box.innerHTML = `<div class="mini" style="grid-column:1/-1;">Sem fotos ainda. Adiciona um ‚ÄúAntes‚Äù e depois vai colocando os ‚ÄúDepois‚Äù üíó</div>`;
      return;
    }

    db.fotos.slice(0,12).forEach((f, idx)=>{
      const card = document.createElement("div");
      card.style.background = "rgba(255,255,255,.06)";
      card.style.border = "1px solid rgba(255,255,255,.12)";
      card.style.borderRadius = "16px";
      card.style.overflow = "hidden";

      card.innerHTML = `
        <img src="${f.dataUrl}" alt="foto" style="width:100%; height:220px; object-fit:cover; display:block;">
        <div style="padding:10px 10px 12px;">
          <b style="font-size:12px;">${escapeHtml(f.legenda || "Foto")}</b>
          <div class="mini">${f.data}</div>
          <div class="row" style="margin-top:8px;">
            <button class="btn secondary" onclick="baixarFoto(${idx})">‚¨áÔ∏è Baixar</button>
            <button class="btn ghost" onclick="apagarFoto(${idx})">üóëÔ∏è</button>
          </div>
        </div>
      `;
      box.appendChild(card);
    });
  }

  function baixarFoto(i){
    const f = db.fotos[i];
    if(!f) return;
    const a = document.createElement("a");
    a.href = f.dataUrl;
    a.download = `foto_${f.data}_${(f.legenda||"").replace(/\\s+/g,"_")}.png`;
    a.click();
  }

  function apagarFoto(i){
    if(!confirm("Apagar essa foto?")) return;
    db.fotos.splice(i,1);
    save();
  }

  function resetFotosConfirm(){
    if(confirm("Apagar TODAS as fotos salvas?")){
      db.fotos = [];
      save();
    }
  }

  /********************
   * DIETA ECON√îMICA (sem tapioca) + lista simples
   ********************/
  function renderDieta(){
    const txt = `
      ‚úÖ <b>Caf√© (06:50)</b>: 2 ovos mexidos + 1 fatia p√£o integral 12 gr√£os + 1 fruta (quando tiver).<br>
      ‚úÖ <b>Lanche (09:40)</b>: mam√£o + aveia (ou ameixa).<br>
      ‚úÖ <b>Almo√ßo (11:30)</b>: 3 colheres arroz + 3 feij√£o + bastante salada + frango/carne.<br>
      ‚úÖ <b>Lanche (14:40)</b>: fruta (alternar).<br>
      ‚úÖ <b>Janta (20:30)</b>: salada + 150g frango desfiado.<br><br>
      üí° <b>Pra incha√ßo</b>: manter √°gua, evitar suco coado todo dia (prefira fruta inteira quando der).<br>
      üí° <b>Intestino</b>: √°gua morna + chia (10 min) ajudou ‚Äî continua registrando no app.
    `;
    document.getElementById("dietaTxt").innerHTML = txt;
  }

  /********************
   * BACKUP EXPORT
   ********************/
  function backupExport(){
    const blob = new Blob([JSON.stringify(db,null,2)], {type:"application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "backup_projeto_ampulheta_miria.json";
    a.click();
    URL.revokeObjectURL(url);
  }

  /********************
   * HELPERS
   ********************/
  function escapeHtml(s){
    return String(s)
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  /********************
   * REFRESH GERAL
   ********************/
  function refreshAll(){
    // telas
    updateAguaUI();
    updateProteinaUI();
    updateIntestinoUI();
    updateMedidasUI();
    updateSemanaUI();
    updateCargasHist();
    renderDieta();

    // treino
    if(document.getElementById("sec-treino").classList.contains("active")){
      renderTreino();
    }
    // fotos
    if(document.getElementById("sec-fotos").classList.contains("active")){
      renderGaleria();
    }
  }

  /********************
   * RESET CONFIRMS
   ********************/
  function resetSemana(){ resetSemanaConfirm(); }
  function resetProteina(){ resetProteinaHoje(); }

  /********************
   * INICIALIZA√á√ÉO
   ********************/
  function initDefaults(){
    // garante today's objects
    ensureAguaToday();
    ensureProtToday();

    // set metas nos inputs
    document.getElementById("aguaMeta").value = db.metas.aguaDia;
    document.getElementById("protMeta").value = db.metas.protDia;
  }

  initDefaults();
  renderDieta();
  renderTreino();
  refreshAll();

  /********************
   * PWA: registra Service Worker
   ********************/
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker.register("./sw.js").catch(()=>{});
    });
  }
</script>

</body>
</html>
